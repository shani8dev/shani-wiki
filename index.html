<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ShaniOS Technical Documentation - Comprehensive guide to the immutable Linux OS with atomic updates, blue-green deployment, and Btrfs filesystem.">
    <meta name="keywords" content="ShaniOS, immutable OS, Linux, Btrfs, atomic updates, blue-green deployment, Arch Linux">
    <meta name="author" content="ShaniOS Project">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="ShaniOS Wiki - Technical Documentation">
    <meta property="og:description" content="Comprehensive technical documentation for ShaniOS - The immutable Linux OS with atomic updates">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://shani.dev">
    <meta property="og:image" content="assets/images/logo.svg">
    
    <!-- Favicons & Manifest -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="assets/images/site.webmanifest">
    <meta name="theme-color" content="#1a102f">

    <title>ShaniOS Wiki - Technical Documentation</title>
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" defer></script>
</head>
<body>
    <div class="wiki-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
                <h2>ShaniOS Wiki</h2>
                <p class="subtitle">Technical Documentation</p>
            </div>
            
            <div class="search-box" role="search">
                <input 
                    type="text" 
                    placeholder="Search documentation..." 
                    aria-label="Search documentation"
                    autocomplete="off">
                <button aria-label="Search"><i class="fas fa-search"></i></button>
            </div>
            
            <ul class="nav-links">
                <li><a href="#overview"><i class="fas fa-home"></i> Overview</a></li>
                <li>
                    <a href="#installation" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-download"></i> Installation
                    </a>
                    <ul class="submenu">
                        <li><a href="#system-requirements">System Requirements</a></li>
                        <li><a href="#pre-installation">Pre-Installation Setup</a></li>
                        <li><a href="#installation-steps">Installation Steps</a></li>
                        <li><a href="#first-boot">First Boot Configuration</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#getting-started" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-rocket"></i> Getting Started
                    </a>
                    <ul class="submenu">
                        <li><a href="#what-is-shanios">What is ShaniOS?</a></li>
                        <li><a href="#key-concepts">Key Concepts</a></li>
                        <li><a href="#understanding-immutability">Understanding Immutability</a></li>
                        <li><a href="#blue-green">Blue-Green Deployment</a></li>
                        <li><a href="#atomic-updates">Atomic Updates</a></li>
                        <li><a href="#persistence">Persistence Strategy</a></li>
                        <li><a href="#security-features">Security Features</a></li>
                        <li><a href="#secure-boot">Secure Boot</a></li>
                        <li><a href="#tpm-encryption">TPM Encryption</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#architecture" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-layer-group"></i> Architecture
                    </a>
                    <ul class="submenu">

                        <li><a href="#btrfs-deep-dive">Btrfs Deep Dive</a></li>
                        <li><a href="#filesystem">Filesystem Structure</a></li>
                        <li><a href="#overlay-fs">Overlay Filesystem</a></li>
                        <li><a href="#boot-process">Boot Process</a></li>

                    </ul>
                </li>
                <li>
                    <a href="#daily-use" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-desktop"></i> Using ShaniOS
                    </a>
                    <ul class="submenu">
                        <li><a href="#system-updates">System Updates</a></li>
                        <li><a href="#software-management">Software Management</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#webhosting" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-cogs"></i> Web Hosting
                    </a>
                    <ul class="submenu">
                        <li><a href="#web-hosting">Web Hosting & Networking</a></li>
                    </ul>
                </li>
                <li><a href="#troubleshooting"><i class="fas fa-wrench"></i> Troubleshooting</a></li>
                <li><a href="#faq"><i class="fas fa-question-circle"></i> FAQ</a></li>
                <li><a href="#contribute"><i class="fas fa-code-branch"></i> Contribute</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Header -->
            <header class="header">
                <div class="logo">
                    <img src="assets/images/logo.svg" alt="ShaniOS Logo" width="150" height="150">
                </div>
                <div class="header-text">
                    <h1>ShaniOS Technical Documentation</h1>
                    <p>Comprehensive guide to the immutable Linux OS with atomic updates</p>
                </div>
            </header>

            <!-- OVERVIEW -->
            <section id="overview" class="wiki-section">
                <h2>Overview</h2>
                <p>Welcome to the ShaniOS technical documentation. This wiki provides comprehensive information about ShaniOS's architecture, installation, configuration, and daily use.</p>
                
                <div class="note-box" role="note">
                    <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                    <div class="note-content">
                        <p><strong>New to ShaniOS?</strong> Visit <a href="https://shani.dev" target="_blank" rel="noopener noreferrer">shani.dev</a> for an introduction. This wiki focuses on technical implementation and usage details.</p>
                    </div>
                </div>

            <!-- INSTALLATION -->
            <section id="installation" class="wiki-section">
                <h2>Installation</h2>

                <div id="system-requirements">
                    <h3>System Requirements</h3>
                    <div class="table-wrapper">
                        <table>
                            <caption class="sr-only">ShaniOS System Requirements</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Component</th>
                                    <th scope="col">Minimum</th>
                                    <th scope="col">Recommended</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">Processor</th>
                                    <td>x86_64 dual-core with VT-x/AMD-V</td>
                                    <td>x86_64 quad-core or better</td>
                                </tr>
                                <tr>
                                    <th scope="row">Memory</th>
                                    <td>4 GB RAM</td>
                                    <td>8 GB RAM or more</td>
                                </tr>
                                <tr>
                                    <th scope="row">Storage</th>
                                    <td>32 GB (dual-image architecture)</td>
                                    <td>64 GB or more</td>
                                </tr>
                                <tr>
                                    <th scope="row">Firmware</th>
                                    <td>UEFI (required)</td>
                                    <td>UEFI with TPM 2.0</td>
                                </tr>
                                <tr>
                                    <th scope="row">Installation Media</th>
                                    <td>8 GB USB drive</td>
                                    <td>16 GB USB 3.0 drive</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Why 32GB minimum?</strong> ShaniOS maintains two complete system images (@blue and @green) for atomic updates. However, Btrfs Copy-on-Write shares unchanged data between them, resulting in only ~18% overhead compared to traditional systems.</p>
                        </div>
                    </div>
                </div>
                
                <div id="pre-installation">
                    <h3>Pre-Installation Setup</h3>
                    
                    <h4>BIOS/UEFI Configuration</h4>
                    <p>Configure your firmware before installation (typically accessed via F2, F10, Del, or Esc during startup):</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Enable UEFI Boot</h4>
                                <p>Disable legacy/CSM mode. ShaniOS requires UEFI</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Disable Fast Boot</h4>
                                <p>Fast Boot can interfere with USB boot and Linux installation</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Disable Secure Boot (Temporarily)</h4>
                                <p>Required for installation. Can be re-enabled after enrolling ShaniOS MOK keys</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Set SATA Mode to AHCI</h4>
                                <p>Ensures optimal disk performance and compatibility</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Enable Virtualization</h4>
                                <p>Enable Intel VT-x or AMD-V for container support</p>
                            </div>
                        </article>
                    </div>

                    <h4>Creating Installation Media</h4>
                    <p>Download the ShaniOS ISO from <a href="https://shani.dev" target="_blank" rel="noopener noreferrer">shani.dev</a> and write it to USB:</p>
                    <ul>
                        <li><strong>Recommended:</strong> Balena Etcher (cross-platform, user-friendly)</li>
                        <li><strong>Windows:</strong> Rufus (advanced options available)</li>
                        <li><strong>Linux/Mac:</strong> dd command or GNOME Disks</li>
                    </ul>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>Do Not Use Ventoy:</strong> Ventoy has known compatibility issues with ShaniOS's immutable architecture and will cause installation failures.</p>
                        </div>
                    </div>
                </div>

                <div id="installation-steps">
                    <h3>Installation Steps</h3>
                    <p>Installation takes approximately 10-15 minutes:</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Boot from USB</h4>
                                <p>Press F12, F2, or Del during startup. Select your USB drive from the boot menu.</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Select "Install ShaniOS"</h4>
                                <p>Choose the installation option from the boot menu</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Language & Region</h4>
                                <p>Select language, timezone, and keyboard layout</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Disk Selection</h4>
                                <p>Choose target disk and partitioning scheme (automatic recommended)</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Encryption (Optional)</h4>
                                <p>Enable LUKS2 full-disk encryption. Recommended for laptops and portable systems.</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>Install</h4>
                                <p>The installer creates Btrfs subvolumes, installs the base system, and configures the bootloader</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">7</div>
                            <div class="step-content">
                                <h4>Reboot</h4>
                                <p>Remove USB drive when prompted and reboot into ShaniOS</p>
                            </div>
                        </article>
                    </div>
                </div>

                <div id="first-boot">
                    <h3>First Boot Configuration</h3>
                    <p>On first boot, the Initial Setup wizard guides you through:</p>
                    <ul>
                        <li>Creating your user account</li>
                        <li>Configuring network connections</li>
                        <li>Setting privacy preferences</li>
                        <li>Enabling location services (optional)</li>
                        <li>Customizing appearance settings</li>
                    </ul>
                    <p>This approach keeps installation fast while personalizing the system on first use.</p>


                </div>
            </section>

            <!-- GETTING STARTED -->
            <section id="getting-started" class="wiki-section">
                <h2>Getting Started</h2>
                
                <div id="what-is-shanios">
                    <h3>What is ShaniOS?</h3>
                    <p>ShaniOS is an immutable Linux distribution that brings enterprise DevOps practices to desktop computing. Built on Arch Linux with Btrfs filesystem, it provides atomic updates, instant rollback, and system integrity by design.</p>

                    <div class="immutability-diagram">
                        <svg viewBox="0 0 1000 400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <!-- Background -->
                            <rect width="1000" height="400" fill="#0b0618"/>
                            
                            <!-- Title -->
                            <text x="500" y="30" text-anchor="middle" fill="#ff8a5c" font-size="22" font-weight="bold">Traditional vs Immutable OS</text>
                            
                            <!-- Traditional OS -->
                            <g>
                                <rect x="50" y="70" width="400" height="280" rx="12" fill="rgba(244,67,54,0.1)" stroke="#F44336" stroke-width="2"/>
                                <text x="250" y="100" text-anchor="middle" fill="#F44336" font-size="18" font-weight="bold">Traditional Linux</text>
                                
                                <!-- System Layer -->
                                <rect x="80" y="120" width="340" height="60" rx="8" fill="rgba(244,67,54,0.3)" stroke="#F44336" stroke-width="1.5"/>
                                <text x="250" y="145" text-anchor="middle" fill="#fff" font-size="14">System Files</text>
                                <text x="250" y="165" text-anchor="middle" fill="#fca5a5" font-size="12">‚úèÔ∏è Writable - Can be modified</text>
                                
                                <!-- Problems -->
                                <text x="250" y="210" text-anchor="middle" fill="#fb923c" font-size="14" font-weight="bold">Common Issues:</text>
                                <text x="250" y="235" text-anchor="middle" fill="#fca5a5" font-size="12">‚ùå Updates can break system</text>
                                <text x="250" y="255" text-anchor="middle" fill="#fca5a5" font-size="12">‚ùå Dependency conflicts</text>
                                <text x="250" y="275" text-anchor="middle" fill="#fca5a5" font-size="12">‚ùå Difficult rollback</text>
                                <text x="250" y="295" text-anchor="middle" fill="#fca5a5" font-size="12">‚ùå System drift over time</text>
                                <text x="250" y="315" text-anchor="middle" fill="#fca5a5" font-size="12">‚ùå Security vulnerabilities</text>
                            </g>
                            
                            <!-- Arrow -->
                            <g>
                                <line x1="460" y1="210" x2="530" y2="210" stroke="#ff8a5c" stroke-width="3" marker-end="url(#arrow-compare)"/>
                                <text x="495" y="200" text-anchor="middle" fill="#ff8a5c" font-size="12" font-weight="bold">vs</text>
                            </g>
                            
                            <!-- ShaniOS -->
                            <g>
                                <rect x="550" y="70" width="400" height="280" rx="12" fill="rgba(76,175,80,0.1)" stroke="#4CAF50" stroke-width="2"/>
                                <text x="750" y="100" text-anchor="middle" fill="#4CAF50" font-size="18" font-weight="bold">ShaniOS (Immutable)</text>
                                
                                <!-- System Layer -->
                                <rect x="580" y="120" width="340" height="60" rx="8" fill="rgba(76,175,80,0.3)" stroke="#4CAF50" stroke-width="1.5"/>
                                <text x="750" y="145" text-anchor="middle" fill="#fff" font-size="14">System Files</text>
                                <text x="750" y="165" text-anchor="middle" fill="#86efac" font-size="12">üîí Read-Only - Protected</text>
                                
                                <!-- Benefits -->
                                <text x="750" y="210" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">Advantages:</text>
                                <text x="750" y="235" text-anchor="middle" fill="#86efac" font-size="12">‚úÖ Atomic updates (all or nothing)</text>
                                <text x="750" y="255" text-anchor="middle" fill="#86efac" font-size="12">‚úÖ Instant rollback capability</text>
                                <text x="750" y="275" text-anchor="middle" fill="#86efac" font-size="12">‚úÖ Zero-downtime updates</text>
                                <text x="750" y="295" text-anchor="middle" fill="#86efac" font-size="12">‚úÖ Consistent system state</text>
                                <text x="750" y="315" text-anchor="middle" fill="#86efac" font-size="12">‚úÖ Enhanced security</text>
                            </g>
                            
                            <defs>
                                <marker id="arrow-compare" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Immutable systems protect core files from modification, ensuring reliability and security</p>
                    </div>
                </div>

                <div id="key-concepts">
                    <h3>Key Concepts</h3>
                    
                    <h4>1. Immutability</h4>
                    <p>The root filesystem (/) is mounted read-only, preventing any modifications to system files. This ensures:</p>
                    <ul>
                        <li>Malware cannot modify system binaries</li>
                        <li>Updates cannot partially fail and corrupt the system</li>
                        <li>System always boots to a known-good state</li>
                        <li>Configuration changes are isolated and manageable</li>
                    </ul>

                <div id="understanding-immutability">
                    <h3>Understanding Immutability</h3>
                    <p>ShaniOS's immutability fundamentally changes how you interact with the system. Understanding this concept is key to using ShaniOS effectively.</p>

                    <h4>What You CAN Do</h4>
                    <ul>
                        <li>‚úÖ Install applications via Flatpak</li>
                        <li>‚úÖ Edit configuration files in /etc</li>
                        <li>‚úÖ Create and modify files in /home</li>
                        <li>‚úÖ Run containers (Podman, Distrobox, LXC)</li>
                        <li>‚úÖ Update the entire system atomically</li>
                        <li>‚úÖ Store data in /data and persistent subvolumes</li>
                    </ul>

                    <h4>What You CANNOT Do</h4>
                    <ul>
                        <li>‚ùå Use pacman to install traditional packages</li>
                        <li>‚ùå Modify files in / (root filesystem)</li>
                        <li>‚ùå Edit files in /usr, /bin, /lib directly</li>
                        <li>‚ùå Install software that requires system-level changes</li>
                    </ul>

                    <h4>Why This Design?</h4>
                    <div class="card-container">
                        <article class="card">
                            <div class="card-icon"><i class="fas fa-shield-alt"></i></div>
                            <h4>Security</h4>
                            <p>Malware cannot modify system files or persist across reboots</p>
                        </article>
                        <article class="card">
                            <div class="card-icon"><i class="fas fa-sync-alt"></i></div>
                            <h4>Reliability</h4>
                            <p>Updates are atomic - they either work completely or fail safely</p>
                        </article>
                        <article class="card">
                            <div class="card-icon"><i class="fas fa-undo"></i></div>
                            <h4>Rollback</h4>
                            <p>Instant recovery from failed updates or system issues</p>
                        </article>
                        <article class="card">
                            <div class="card-icon"><i class="fas fa-check-double"></i></div>
                            <h4>Consistency</h4>
                            <p>System state is always predictable and reproducible</p>
                        </article>
                    </div>

                    <h4>2. Blue-Green Deployment</h4>
                    <p>ShaniOS maintains two complete system images (@blue and @green). While one is active, updates are applied to the inactive one. On next boot, you switch to the updated system. If it fails, automatic rollback occurs.</p>

                <div id="blue-green">
                    <h3>Blue-Green Deployment</h3>
                    <p>ShaniOS implements blue-green deployment using Btrfs subvolumes‚Äîa strategy adapted from DevOps for desktop Linux.</p>
                    
                    <div class="blue-green-diagram">
                        <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="800" height="400" fill="#0b0618"/>
                            
                            <text x="400" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">Blue-Green Deployment Model</text>
                            
                            <!-- Blue System -->
                            <g>
                                <rect x="50" y="80" width="300" height="240" rx="12" fill="#1e3a8a" opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
                                <text x="200" y="110" text-anchor="middle" fill="#60a5fa" font-size="20" font-weight="bold">@blue (Active)</text>
                                <text x="200" y="140" text-anchor="middle" fill="#93c5fd" font-size="14">Currently Running</text>
                                <circle cx="200" cy="200" r="40" fill="#3b82f6" opacity="0.5"/>
                                <text x="200" y="210" text-anchor="middle" fill="#fff" font-size="16">System</text>
                                <text x="200" y="280" text-anchor="middle" fill="#93c5fd" font-size="12">Mounted as /</text>
                            </g>
                            
                            <!-- Green System -->
                            <g>
                                <rect x="450" y="80" width="300" height="240" rx="12" fill="#166534" opacity="0.3" stroke="#22c55e" stroke-width="2"/>
                                <text x="600" y="110" text-anchor="middle" fill="#4ade80" font-size="20" font-weight="bold">@green (Inactive)</text>
                                <text x="600" y="140" text-anchor="middle" fill="#86efac" font-size="14">Ready for Update</text>
                                <circle cx="600" cy="200" r="40" fill="#22c55e" opacity="0.5"/>
                                <text x="600" y="210" text-anchor="middle" fill="#fff" font-size="16">System</text>
                                <text x="600" y="280" text-anchor="middle" fill="#86efac" font-size="12">Standby Mode</text>
                            </g>
                            
                            <!-- Arrow -->
                            <g>
                                <line x1="350" y1="200" x2="430" y2="200" stroke="#ff8a5c" stroke-width="3" marker-end="url(#arrowhead)"/>
                                <text x="390" y="190" text-anchor="middle" fill="#ff8a5c" font-size="14">Update Flow</text>
                            </g>
                            
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Two complete system images with only one active at a time</p>
                    </div>
                    
                    <h4>How It Works</h4>
                    <ol>
                        <li>System maintains @blue and @green subvolumes</li>
                        <li>One subvolume is active (mounted as /), the other inactive</li>
                        <li>Updates apply to inactive subvolume</li>
                        <li>Bootloader updated to point to updated subvolume</li>
                        <li>Reboot switches to updated system</li>
                        <li>Previous version remains available for instant rollback</li>
                    </ol>
                    
                    <h4>Advantages</h4>
                    <ul>
                        <li><strong>Atomic Updates:</strong> All-or-nothing updates</li>
                        <li><strong>Zero Downtime:</strong> Active system never modified</li>
                        <li><strong>Instant Rollback:</strong> Boot into previous version anytime</li>
                        <li><strong>Safe Testing:</strong> Validate updates before committing</li>
                    </ul>
                </div>

                <div id="atomic-updates">
                    <h4>3. Atomic Updates</h4>
                    <p>Updates either succeed completely or fail safely‚Äîno partial updates that leave your system in a broken state. This is achieved through:</p>
                    <ul>
                        <li>Updating the inactive system image</li>
                        <li>Switching boot target only after successful update</li>
                        <li>Automatic rollback on boot failure</li>
                    </ul>

                    <p>ShaniOS uses an intelligent multi-layered update system with automatic checking, user notifications, and the <code>shani-deploy</code> tool for atomic system updates.</p>

                    <div class="update-flow-diagram">
                        <svg viewBox="0 0 1000 500" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="1000" height="500" fill="#0b0618"/>
                            
                            <text x="500" y="30" text-anchor="middle" fill="#ff8a5c" font-size="22" font-weight="bold">Update Process Flow</text>
                            
                            <!-- Step 1 -->
                            <g>
                                <circle cx="150" cy="100" r="40" fill="#2196F3" opacity="0.3" stroke="#2196F3" stroke-width="2"/>
                                <text x="150" y="85" text-anchor="middle" fill="#fff" font-size="24">1</text>
                                <text x="150" y="110" text-anchor="middle" fill="#fff" font-size="12">Check</text>
                                <text x="150" y="160" text-anchor="middle" fill="#93c5fd" font-size="11">Auto checker runs</text>
                                <text x="150" y="175" text-anchor="middle" fill="#93c5fd" font-size="11">Finds new release</text>
                            </g>
                            
                            <line x1="190" y1="100" x2="260" y2="100" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-update)"/>
                            
                            <!-- Step 2 -->
                            <g>
                                <circle cx="300" cy="100" r="40" fill="#9C27B0" opacity="0.3" stroke="#9C27B0" stroke-width="2"/>
                                <text x="300" y="85" text-anchor="middle" fill="#fff" font-size="24">2</text>
                                <text x="300" y="110" text-anchor="middle" fill="#fff" font-size="12">Notify</text>
                                <text x="300" y="160" text-anchor="middle" fill="#d8b4fe" font-size="11">GUI notification</text>
                                <text x="300" y="175" text-anchor="middle" fill="#d8b4fe" font-size="11">User approval</text>
                            </g>
                            
                            <line x1="340" y1="100" x2="410" y2="100" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-update)"/>
                            
                            <!-- Step 3 -->
                            <g>
                                <circle cx="450" cy="100" r="40" fill="#FF9800" opacity="0.3" stroke="#FF9800" stroke-width="2"/>
                                <text x="450" y="85" text-anchor="middle" fill="#fff" font-size="24">3</text>
                                <text x="450" y="110" text-anchor="middle" fill="#fff" font-size="12">Download</text>
                                <text x="450" y="160" text-anchor="middle" fill="#fbbf24" font-size="11">Mirror discovery</text>
                                <text x="450" y="175" text-anchor="middle" fill="#fbbf24" font-size="11">Resume support</text>
                            </g>
                            
                            <line x1="490" y1="100" x2="560" y2="100" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-update)"/>
                            
                            <!-- Step 4 -->
                            <g>
                                <circle cx="600" cy="100" r="40" fill="#F44336" opacity="0.3" stroke="#F44336" stroke-width="2"/>
                                <text x="600" y="85" text-anchor="middle" fill="#fff" font-size="24">4</text>
                                <text x="600" y="110" text-anchor="middle" fill="#fff" font-size="12">Verify</text>
                                <text x="600" y="160" text-anchor="middle" fill="#fca5a5" font-size="11">SHA256 checksum</text>
                                <text x="600" y="175" text-anchor="middle" fill="#fca5a5" font-size="11">GPG signature</text>
                            </g>
                            
                            <line x1="640" y1="100" x2="710" y2="100" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-update)"/>
                            
                            <!-- Step 5 -->
                            <g>
                                <circle cx="750" cy="100" r="40" fill="#4CAF50" opacity="0.3" stroke="#4CAF50" stroke-width="2"/>
                                <text x="750" y="85" text-anchor="middle" fill="#fff" font-size="24">5</text>
                                <text x="750" y="110" text-anchor="middle" fill="#fff" font-size="12">Deploy</text>
                                <text x="750" y="160" text-anchor="middle" fill="#86efac" font-size="11">Extract to inactive</text>
                                <text x="750" y="175" text-anchor="middle" fill="#86efac" font-size="11">Update bootloader</text>
                            </g>
                            
                            <!-- Current State -->
                            <g>
                                <rect x="50" y="250" width="400" height="200" rx="10" fill="rgba(33,150,243,0.1)" stroke="#2196F3" stroke-width="2"/>
                                <text x="250" y="280" text-anchor="middle" fill="#2196F3" font-size="16" font-weight="bold">Before Update</text>
                                
                                <rect x="100" y="300" width="140" height="60" rx="6" fill="#2196F3" opacity="0.5"/>
                                <text x="170" y="320" text-anchor="middle" fill="#fff" font-size="13">@blue</text>
                                <text x="170" y="340" text-anchor="middle" fill="#fff" font-size="11">‚úÖ Active (Booted)</text>
                                
                                <rect x="260" y="300" width="140" height="60" rx="6" fill="rgba(76,175,80,0.3)" stroke="#4CAF50" stroke-width="1"/>
                                <text x="330" y="320" text-anchor="middle" fill="#fff" font-size="13">@green</text>
                                <text x="330" y="340" text-anchor="middle" fill="#86efac" font-size="11">‚è∏Ô∏è Inactive (Old)</text>
                                
                                <text x="250" y="395" text-anchor="middle" fill="#93c5fd" font-size="12">shani-deploy runs while booted into @blue</text>
                                <text x="250" y="420" text-anchor="middle" fill="#93c5fd" font-size="12">Update is written to @green</text>
                            </g>
                            
                            <!-- After State -->
                            <g>
                                <rect x="550" y="250" width="400" height="200" rx="10" fill="rgba(76,175,80,0.1)" stroke="#4CAF50" stroke-width="2"/>
                                <text x="750" y="280" text-anchor="middle" fill="#4CAF50" font-size="16" font-weight="bold">After Reboot</text>
                                
                                <rect x="600" y="300" width="140" height="60" rx="6" fill="rgba(33,150,243,0.3)" stroke="#2196F3" stroke-width="1"/>
                                <text x="670" y="320" text-anchor="middle" fill="#fff" font-size="13">@blue</text>
                                <text x="670" y="340" text-anchor="middle" fill="#93c5fd" font-size="11">‚è∏Ô∏è Inactive (Rollback)</text>
                                
                                <rect x="760" y="300" width="140" height="60" rx="6" fill="#4CAF50" opacity="0.5"/>
                                <text x="830" y="320" text-anchor="middle" fill="#fff" font-size="13">@green</text>
                                <text x="830" y="340" text-anchor="middle" fill="#fff" font-size="11">‚úÖ Active (Updated!)</text>
                                
                                <text x="750" y="395" text-anchor="middle" fill="#86efac" font-size="12">System boots into @green with new version</text>
                                <text x="750" y="420" text-anchor="middle" fill="#86efac" font-size="12">@blue remains as instant rollback option</text>
                            </g>
                            
                            <defs>
                                <marker id="arrow-update" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Zero-downtime update process with automatic rollback capability</p>
                    </div>
                </div>

                    <h4>4. Selective Persistence</h4>
                    <p>While the system is immutable, user data and configurations persist:</p>
                    <ul>
                        <li><strong>/home:</strong> Your personal files and settings</li>
                        <li><strong>/etc:</strong> System configuration (via overlay filesystem)</li>
                        <li><strong>Service data:</strong> Application states, databases, containers</li>
                    </ul>

                    <div class="persistence-diagram">
                        <svg viewBox="0 0 900 350" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="900" height="350" fill="#0b0618"/>
                            
                            <text x="450" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">What Persists Across Updates?</text>
                            
                            <!-- Immutable -->
                            <g>
                                <rect x="50" y="70" width="250" height="240" rx="10" fill="rgba(244,67,54,0.15)" stroke="#F44336" stroke-width="2"/>
                                <text x="175" y="100" text-anchor="middle" fill="#F44336" font-size="16" font-weight="bold">‚ùå Immutable (Replaced)</text>
                                
                                <text x="175" y="135" text-anchor="middle" fill="#fca5a5" font-size="13">/ (root filesystem)</text>
                                <text x="175" y="160" text-anchor="middle" fill="#fca5a5" font-size="13">/usr (programs)</text>
                                <text x="175" y="185" text-anchor="middle" fill="#fca5a5" font-size="13">/bin, /sbin (binaries)</text>
                                <text x="175" y="210" text-anchor="middle" fill="#fca5a5" font-size="13">/lib (libraries)</text>
                                <text x="175" y="235" text-anchor="middle" fill="#fca5a5" font-size="13">/opt (optional software)</text>
                                
                                <text x="175" y="275" text-anchor="middle" fill="#fb923c" font-size="12" font-style="italic">Gets new version on update</text>
                            </g>
                            
                            <!-- Persistent -->
                            <g>
                                <rect x="350" y="70" width="250" height="240" rx="10" fill="rgba(76,175,80,0.15)" stroke="#4CAF50" stroke-width="2"/>
                                <text x="475" y="100" text-anchor="middle" fill="#4CAF50" font-size="16" font-weight="bold">‚úÖ Persistent (Kept)</text>
                                
                                <text x="475" y="135" text-anchor="middle" fill="#86efac" font-size="13">/home (your files)</text>
                                <text x="475" y="160" text-anchor="middle" fill="#86efac" font-size="13">/etc (configurations)</text>
                                <text x="475" y="185" text-anchor="middle" fill="#86efac" font-size="13">/var/log (system logs)</text>
                                <text x="475" y="210" text-anchor="middle" fill="#86efac" font-size="13">/data (app data)</text>
                                <text x="475" y="235" text-anchor="middle" fill="#86efac" font-size="13">Flatpak apps</text>
                                <text x="475" y="260" text-anchor="middle" fill="#86efac" font-size="13">Containers & VMs</text>
                                
                                <text x="475" y="290" text-anchor="middle" fill="#4ade80" font-size="12" font-style="italic">Survives all updates</text>
                            </g>
                            
                            <!-- Volatile -->
                            <g>
                                <rect x="650" y="70" width="200" height="240" rx="10" fill="rgba(156,39,176,0.15)" stroke="#9C27B0" stroke-width="2"/>
                                <text x="750" y="100" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="bold">üîÑ Volatile (Temporary)</text>
                                
                                <text x="750" y="135" text-anchor="middle" fill="#d8b4fe" font-size="13">/var (tmpfs)</text>
                                <text x="750" y="160" text-anchor="middle" fill="#d8b4fe" font-size="13">/tmp (temporary)</text>
                                <text x="750" y="185" text-anchor="middle" fill="#d8b4fe" font-size="13">/run (runtime)</text>
                                
                                <text x="750" y="230" text-anchor="middle" fill="#c084fc" font-size="12" font-style="italic">Cleared on reboot</text>
                                <text x="750" y="250" text-anchor="middle" fill="#c084fc" font-size="12" font-style="italic">(except bind-mounted)</text>
                                <text x="750" y="270" text-anchor="middle" fill="#c084fc" font-size="12" font-style="italic">service data)</text>
                            </g>
                        </svg>
                        <p class="caption">ShaniOS intelligently separates immutable system files from persistent user data</p>
                    </div>
                </div>

                <div id="persistence">
                    <h3>Persistence Strategy</h3>
                    <p>ShaniOS selectively persists data across immutable system updates through bind mounts and dedicated subvolumes.</p>

                                       
                    <h4>Bind-Mounted Service State</h4>
                    <p>Critical service data is bind-mounted from @data subvolume:</p>
                    
                    <div class="code-block">
                        <pre><code># Example bind mounts from fstab

# Network configuration
/data/varlib/NetworkManager /var/lib/NetworkManager none bind,nofail 0 0

# Bluetooth pairings
/data/varlib/bluetooth /var/lib/bluetooth none bind,nofail 0 0

# systemd state
/data/varlib/systemd /var/lib/systemd none bind,nofail 0 0</code></pre>
                    </div>
                    
                    <h4>What Persists</h4>
                    <ul>
                        <li><strong>Core:</strong> dbus, systemd, NetworkManager</li>
                        <li><strong>Authentication:</strong> AccountsService, fprint, bluetooth, boltd</li>
                        <li><strong>Display:</strong> gdm, sddm</li>
                        <li><strong>Hardware:</strong> colord, upower, cups, sane</li>
                        <li><strong>Security:</strong> firewalld</li>
                        <li><strong>Networking:</strong> geoclue, samba, nfs</li>
                    </ul>

                    <h4>Bind Mount Handling</h4>
                    <p>ShaniOS intelligently handles bind mounts during configuration:</p>
                    <ul>
                        <li><strong>Source check:</strong> Only mounts if source directory exists in @data</li>
                        <li><strong>Target check:</strong> Only mounts if service is installed in the system</li>
                        <li><strong>Graceful skipping:</strong> Missing services (e.g., sddm on GNOME) don't cause errors</li>
                        <li><strong>Optional services:</strong> Services not present in base system are automatically skipped</li>
                    </ul>

                    <h4>Spool Directory Persistence</h4>
                    <p>In addition to /var/lib, some /var/spool directories are also persisted:</p>
                    <ul>
                        <li><strong>anacron:</strong> Scheduled job state</li>
                        <li><strong>cron:</strong> Cron job state</li>
                        <li><strong>cups:</strong> Print queue</li>
                        <li><strong>samba:</strong> Samba print queue</li>
                    </ul>
                </div>
                    
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Behavior</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">/</th>
                                    <td>Read-only</td>
                                    <td>Immutable system files</td>
                                </tr>
                                <tr>
                                    <th scope="row">/etc</th>
                                    <td>Overlay</td>
                                    <td>Writable, persists in @data</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var</th>
                                    <td>tmpfs</td>
                                    <td>Volatile, cleared on reboot</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var/log</th>
                                    <td>Btrfs @log</td>
                                    <td>Persistent logs</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var/lib/*</th>
                                    <td>Bind mount</td>
                                    <td>Selective persistence from @data/varlib</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var/spool/*</th>
                                    <td>Bind mount</td>
                                    <td>Selective persistence from @data/varspool</td>
                                </tr>
                                <tr>
                                    <th scope="row">/home</th>
                                    <td>Btrfs @home</td>
                                    <td>Persistent user data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>     
                    
                <div id="security-features">
                    <h3>Security Features</h3>
                    <p>ShaniOS implements defense-in-depth security:</p>
                    
                    <div class="card-container">
                        <article class="card">
                            <div class="card-icon">üîí</div>
                            <h4>Immutable Root</h4>
                            <p>Read-only filesystem prevents malware from modifying system files</p>
                        </article>
                        <article class="card">
                            <div class="card-icon">üîê</div>
                            <h4>Full-Disk Encryption</h4>
                            <p>LUKS2 with argon2id protects data at rest</p>
                        </article>
                        <article class="card">
                            <div class="card-icon">üì¶</div>
                            <h4>App Sandboxing</h4>
                            <p>Flatpak provides application isolation and permission control</p>
                        </article>
                        <article class="card">
                            <div class="card-icon">üõ°Ô∏è</div>
                            <h4>AppArmor MAC</h4>
                            <p>Mandatory access control confines system services</p>
                        </article>
                        <article class="card">
                            <div class="card-icon">üî•</div>
                            <h4>Active Firewall</h4>
                            <p>firewalld denies inbound connections by default</p>
                        </article>
                    </div>
                    <h4>What's Included</h4>
                    <p>ShaniOS comes pre-configured with everything you need:</p>
                    <ul>
                        <li><strong>Base:</strong> Arch Linux foundation, Btrfs filesystem, systemd-boot</li>
                        <li><strong>Desktop:</strong> GNOME or KDE Plasma (chosen at download)</li>
                        <li><strong>Applications:</strong> Vivaldi Browser, OnlyOffice, Gear Lever</li>
                        <li><strong>Containers:</strong> Podman, Distrobox, LXC, systemd-nspawn, Pods GUI</li>
                        <li><strong>Android:</strong> Waydroid pre-installed and configured</li>
                        <li><strong>Drivers:</strong> Intel/AMD/NVIDIA graphics, CUPS printing, SANE scanning</li>
                        <li><strong>Fonts:</strong> Complete multilingual support including Indian languages and CJK</li>
                        <li><strong>Security:</strong> AppArmor, firewalld, LUKS2 encryption (optional)</li>
                        <li><strong>Shell:</strong> Zsh as default user shell with enhanced features</li>
                    </ul>

                    <h4>Default User Groups</h4>
                    <p>The primary user is automatically added to these groups for hardware and system access:</p>
                    <ul>
                        <li><strong>wheel:</strong> Administrative privileges via sudo</li>
                        <li><strong>input:</strong> Direct input device access</li>
                        <li><strong>realtime:</strong> Real-time process scheduling (audio/video)</li>
                        <li><strong>video:</strong> GPU and video hardware access</li>
                        <li><strong>sys:</strong> System hardware monitoring</li>
                        <li><strong>cups & lp:</strong> Printer management</li>
                        <li><strong>libvirt & kvm:</strong> Virtual machine management</li>
                        <li><strong>scanner:</strong> Scanner device access</li>
                    </ul>

                    <h4>Pre-configured Firewall Rules</h4>
                    <p>ShaniOS configures firewall rules during installation for essential services:</p>
                    <ul>
                        <li><strong>KDE Connect/GSConnect:</strong> Ports automatically opened in public zone for device synchronization</li>
                        <li><strong>Waydroid:</strong> DNS (port 53/udp, 67/udp), packet forwarding, and waydroid0 interface added to trusted zone</li>
                    </ul>
                </div>


                <div id="secure-boot">
                    <h3>Secure Boot Setup</h3>
                    <p>ShaniOS supports UEFI Secure Boot via Machine Owner Keys (MOK).</p>
                    
                    <h4>Automatic Secure Boot Enrollment (If Enabled During Install)</h4>
                    <p>If you enabled Secure Boot during installation:</p>
                    <ol>
                        <li>On first reboot, MOK Manager will appear automatically</li>
                        <li>Select "Enroll MOK"</li>
                        <li>Enter the password: <code>shanios</code></li>
                        <li>Reboot to complete the enrollment</li>
                        <li>Secure Boot will be active with ShaniOS keys enrolled</li>
                    </ol>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>MOK (Machine Owner Key):</strong> This allows ShaniOS's signed bootloader and kernel to boot with Secure Boot enabled. The password "shanios" is only used during the one-time enrollment process and is not stored.</p>
                        </div>
                    </div>
                    
                    <h4>Manual Secure Boot Enablement</h4>
                    <p>To enable Secure Boot after installation:</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Import MOK Key</h4>
                                <div class="code-block">
                                    <pre><code>sudo mokutil --import /etc/secureboot/keys/MOK.der</code></pre>
                                </div>
                                <p>Set a one-time password when prompted</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Reboot and Enroll</h4>
                                <p>MOK Manager appears on reboot. Select "Enroll MOK" and enter your password</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Enable in BIOS</h4>
                                <p>Enter BIOS/UEFI settings and enable Secure Boot if still disabled</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Verify Enrollment</h4>
                                <div class="code-block">
                                    <pre><code>sudo mokutil --list-enrolled</code></pre>
                                </div>
                            </div>
                        </article>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Note:</strong> If MOK Manager doesn't appear, repeat step 1 and reboot. It only triggers when a key is pending enrollment.</p>
                        </div>
                    </div>
                </div>

                    <h3>Encryption Methods</h3>
                    
                    <h4>Password-based (Default)</h4>
                    <p>If you provide a password during installation, LUKS will be unlocked with your password at boot.</p>
                
                <div id="tpm-encryption">
                    <h4>TPM-Based Encryption</h4>
                    <p>Enroll your LUKS encryption key to TPM 2.0 for automatic unlocking.</p>
                    
                    <h4>Prerequisites</h4>
                    <ul>
                        <li>TPM 2.0 hardware module (enabled in BIOS/UEFI)</li>
                        <li>LUKS2 encryption enabled during installation</li>
                        <li><strong>Recommended:</strong> Secure Boot enabled for maximum security</li>
                    </ul>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>Security Warning:</strong> Without Secure Boot, attackers with physical access can replace your bootloader to steal the encryption key. With Secure Boot, TPM refuses to unlock if the system is tampered with.</p>
                        </div>
                    </div>
                    
                    <h4>Enrollment Process</h4>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Verify TPM</h4>
                                <div class="code-block">
                                    <pre><code>systemd-cryptenroll --tpm2-device=list</code></pre>
                                </div>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Check Secure Boot Status</h4>
                                <div class="code-block">
                                    <pre><code>mokutil --sb-state</code></pre>
                                </div>
                                <p>If disabled, consider enabling Secure Boot first</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Find Your LUKS Device</h4>
                                <p>ShaniOS uses <code>/dev/mapper/shani_root</code> as the unlocked LUKS mapping. To find the underlying encrypted device:</p>
                                <div class="code-block">
                                    <pre><code># Get the physical encrypted device
LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')
echo "Your encrypted device is: $LUKS_DEVICE"

# Example output: /dev/sda2 or /dev/nvme0n1p2</code></pre>
                                </div>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Enroll Encryption Key</h4>
                                <p><strong>With Secure Boot (recommended):</strong></p>
                                <div class="code-block">
                                    <pre><code>LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')
sudo systemd-cryptenroll --tpm2-device=auto --tpm2-pcrs=0+7 "$LUKS_DEVICE"</code></pre>
                                </div>
                                <p><strong>Without Secure Boot:</strong></p>
                                <div class="code-block">
                                    <pre><code>LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')
sudo systemd-cryptenroll --tpm2-device=auto --tpm2-pcrs=0 "$LUKS_DEVICE"</code></pre>
                                </div>
                                <p>Enter your LUKS password when prompted</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Regenerate Boot Images</h4>
                                <p>Both @blue and @green must be updated:</p>
                                <div class="code-block">
                                    <pre><code>sudo gen-efi configure blue
sudo gen-efi configure green</code></pre>
                                </div>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>Test & Verify</h4>
                                <p>Reboot. System should unlock automatically.</p>
                                <div class="code-block">
                                    <pre><code># Verify enrollment
LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')
sudo cryptsetup luksDump "$LUKS_DEVICE" | grep systemd-tpm2</code></pre>
                                </div>
                            </div>
                        </article>
                    </div>
                    
                    <h4>Remove TPM Enrollment</h4>
                    <p>To restore password-only unlocking:</p>
                    <div class="code-block">
                        <pre><code>LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')
sudo systemd-cryptenroll --wipe-slot=tpm2 "$LUKS_DEVICE"
sudo gen-efi configure blue
sudo gen-efi configure green</code></pre>
                    </div>
                    
                    <h4>Re-enroll After Enabling Secure Boot</h4>
                    <p>If you enable Secure Boot after TPM enrollment:</p>
                    <div class="code-block">
                        <pre><code># Get the device
LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep 'device:' | awk '{print $2}')

# Remove old enrollment
sudo systemd-cryptenroll --wipe-slot=tpm2 "$LUKS_DEVICE"

# Re-enroll with Secure Boot protection
sudo systemd-cryptenroll --tpm2-device=auto --tpm2-pcrs=0+7 "$LUKS_DEVICE"

# Update boot images
sudo gen-efi configure blue
sudo gen-efi configure green</code></pre>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Important:</strong></p>
                            <ul>
                                <li>Your LUKS password remains valid as fallback</li>
                                <li>Firmware changes break TPM unlock (password required)</li>
                                <li>Both boot images must be regenerated</li>
                                <li>Keep LUKS password secure for recovery</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="architecture" class="wiki-section">
                <h2>Architecture</h2>
                                
                <div id="btrfs-deep-dive">
                    <h3>Btrfs Deep Dive</h3>
                    <p>ShaniOS leverages advanced Btrfs features for immutability and efficiency.</p>
                    
                    <h4>Copy-on-Write (CoW)</h4>
                    <p>Btrfs CoW minimizes storage duplication:</p>
                    <ul>
                        <li>Shared data blocks between @blue and @green</li>
                        <li>Only ~18% overhead despite dual root system</li>
                        <li>Modified blocks consume additional space</li>
                        <li>Efficient updates even with two complete systems</li>
                    </ul>
                    
                    <h4>Transparent Compression</h4>
                    <div class="code-block">
                        <pre><code># Default mount options
compress=zstd,space_cache=v2,autodefrag</code></pre>
                    </div>
                    <ul>
                        <li>Reduces disk usage by 30-50%</li>
                        <li>Minimal CPU overhead</li>
                        <li>Improves SSD lifespan</li>
                    </ul>
                    
                    <h4>Performance Optimizations</h4>
                    <p>Specific subvolumes use <code>nodatacow</code>:</p>
                    <ul>
                        <li><strong>@swap:</strong> CoW disabled for swap files (required)</li>
                        <li><strong>@libvirt:</strong> VM disk images benefit from direct writes</li>
                    </ul>

                    <h4>Mount Options by Subvolume</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Subvolume</th>
                                    <th>Mount Options</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">@blue / @green</th>
                                    <td>ro,noatime,compress=zstd,space_cache=v2,autodefrag</td>
                                    <td>Read-only root with compression</td>
                                </tr>
                                <tr>
                                    <th scope="row">@home, @data, @cache, @log</th>
                                    <td>rw,noatime,compress=zstd,autodefrag,space_cache=v2</td>
                                    <td>Read-write with compression</td>
                                </tr>
                                <tr>
                                    <th scope="row">@flatpak, @waydroid, @containers</th>
                                    <td>rw,noatime,compress=zstd,autodefrag,space_cache=v2</td>
                                    <td>Application storage with compression</td>
                                </tr>
                                <tr>
                                    <th scope="row">@machines, @lxc</th>
                                    <td>rw,noatime,compress=zstd,autodefrag,space_cache=v2</td>
                                    <td>Container storage</td>
                                </tr>
                                <tr>
                                    <th scope="row">@libvirt</th>
                                    <td>rw,noatime,nodatacow,nospace_cache</td>
                                    <td>VM performance (no CoW, no compression)</td>
                                </tr>
                                <tr>
                                    <th scope="row">@swap</th>
                                    <td>rw,noatime,nodatacow,nospace_cache</td>
                                    <td>Swap file requirement (no CoW)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h4>Why noatime?</h4>
                    <p>All subvolumes use <code>noatime</code> to improve performance:</p>
                    <ul>
                        <li>Prevents writing to disk every time a file is read</li>
                        <li>Significantly reduces SSD wear</li>
                        <li>Improves battery life on laptops</li>
                        <li>No impact on most applications (very few rely on access times)</li>
                    </ul>
                </div>

                    <div id="filesystem">
                    <h3>Filesystem Structure</h3>
                    <p>ShaniOS uses Btrfs with a sophisticated subvolume layout:</p>

                    <div class="architecture-diagram">
                        <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="800" height="500" fill="#0b0618"/>
                            
                            <text x="400" y="30" text-anchor="middle" fill="#ff8a5c" font-size="22" font-weight="bold">Btrfs Subvolume Structure</text>
                            
                            <!-- Root Device -->
                            <rect x="300" y="60" width="200" height="40" rx="8" fill="#8b5cf6" opacity="0.4" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="400" y="85" text-anchor="middle" fill="#fff" font-size="14">/dev/sda2 (Btrfs)</text>
                            
                            <!-- System Layer -->
                            <g>
                                <rect x="50" y="130" width="280" height="160" rx="8" fill="#1e3a8a" opacity="0.2" stroke="#3b82f6" stroke-width="1.5"/>
                                <text x="190" y="155" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">System Images</text>
                                
                                <rect x="70" y="170" width="100" height="35" rx="6" fill="#3b82f6" opacity="0.5"/>
                                <text x="120" y="192" text-anchor="middle" fill="#fff" font-size="12">@blue</text>
                                
                                <rect x="210" y="170" width="100" height="35" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="260" y="192" text-anchor="middle" fill="#fff" font-size="12">@green</text>
                                
                                <text x="190" y="230" text-anchor="middle" fill="#93c5fd" font-size="11">Root filesystems</text>
                                <text x="190" y="250" text-anchor="middle" fill="#93c5fd" font-size="11">Read-only</text>
                            </g>
                            
                            <!-- User Data Layer -->
                            <g>
                                <rect x="370" y="130" width="180" height="160" rx="8" fill="#166534" opacity="0.2" stroke="#22c55e" stroke-width="1.5"/>
                                <text x="460" y="155" text-anchor="middle" fill="#4ade80" font-size="16" font-weight="bold">User Data</text>
                                
                                <rect x="390" y="170" width="140" height="30" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="460" y="190" text-anchor="middle" fill="#fff" font-size="12">@home</text>
                                
                                <rect x="390" y="210" width="140" height="30" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="460" y="230" text-anchor="middle" fill="#fff" font-size="12">@data</text>
                                
                                <text x="460" y="260" text-anchor="middle" fill="#86efac" font-size="11">Persistent</text>
                            </g>
                            
                            <!-- Services Layer -->
                            <g>
                                <rect x="590" y="130" width="180" height="160" rx="8" fill="#7c2d12" opacity="0.2" stroke="#f97316" stroke-width="1.5"/>
                                <text x="680" y="155" text-anchor="middle" fill="#fb923c" font-size="16" font-weight="bold">Services</text>
                                
                                <rect x="610" y="170" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="186" text-anchor="middle" fill="#fff" font-size="11">@flatpak</text>
                                
                                <rect x="610" y="200" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="216" text-anchor="middle" fill="#fff" font-size="11">@containers</text>
                                
                                <rect x="610" y="230" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="246" text-anchor="middle" fill="#fff" font-size="11">@waydroid</text>
                                
                                <text x="680" y="270" text-anchor="middle" fill="#fdba74" font-size="11">Isolated</text>
                            </g>
                            
                            <!-- System Volumes -->
                            <g>
                                <rect x="50" y="320" width="700" height="150" rx="8" fill="#581c87" opacity="0.2" stroke="#a855f7" stroke-width="1.5"/>
                                <text x="400" y="345" text-anchor="middle" fill="#c084fc" font-size="16" font-weight="bold">Additional Subvolumes</text>
                                
                                <rect x="70" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="125" y="378" text-anchor="middle" fill="#fff" font-size="11">@log</text>
                                
                                <rect x="200" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="255" y="378" text-anchor="middle" fill="#fff" font-size="11">@cache</text>
                                
                                <rect x="330" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="385" y="378" text-anchor="middle" fill="#fff" font-size="11">@machines</text>
                                
                                <rect x="460" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="515" y="378" text-anchor="middle" fill="#fff" font-size="11">@lxc</text>
                                
                                <rect x="590" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="645" y="378" text-anchor="middle" fill="#fff" font-size="11">@libvirt</text>
                                
                                <rect x="320" y="405" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="375" y="423" text-anchor="middle" fill="#fff" font-size="11">@swap</text>
                            </g>
                        </svg>
                        <p class="caption">Organized subvolume layout separating system, user data, and services</p>
                    </div>
                    
                    <div class="table-wrapper">
                        <table>
                            <caption class="sr-only">ShaniOS Subvolume Layout</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Subvolume</th>
                                    <th scope="col">Mount Point</th>
                                    <th scope="col">Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">@blue / @green</th>
                                    <td>/</td>
                                    <td>Root filesystems for blue-green deployment</td>
                                </tr>
                                <tr>
                                    <th scope="row">@home</th>
                                    <td>/home</td>
                                    <td>User data and personal configurations</td>
                                </tr>
                                <tr>
                                    <th scope="row">@data</th>
                                    <td>/data</td>
                                    <td>Overlay storage and persistent service data</td>
                                </tr>
                                <tr>
                                    <th scope="row">@log</th>
                                    <td>/var/log</td>
                                    <td>System logs across reboots</td>
                                </tr>
                                <tr>
                                    <th scope="row">@cache</th>
                                    <td>/var/cache</td>
                                    <td>Package manager cache</td>
                                </tr>
                                <tr>
                                    <th scope="row">@flatpak</th>
                                    <td>/var/lib/flatpak</td>
                                    <td>Flatpak applications and runtimes</td>
                                </tr>
                                <tr>
                                    <th scope="row">@waydroid</th>
                                    <td>/var/lib/waydroid</td>
                                    <td>Android system images and data</td>
                                </tr>
                                <tr>
                                    <th scope="row">@containers</th>
                                    <td>/var/lib/containers</td>
                                    <td>Podman/Docker container storage</td>
                                </tr>
                                <tr>
                                    <th scope="row">@machines</th>
                                    <td>/var/lib/machines</td>
                                    <td>systemd-nspawn containers</td>
                                </tr>
                                <tr>
                                    <th scope="row">@lxc</th>
                                    <td>/var/lib/lxc</td>
                                    <td>LXC containers</td>
                                </tr>
                                <tr>
                                    <th scope="row">@libvirt</th>
                                    <td>/var/lib/libvirt</td>
                                    <td>Virtual machine disk images (nodatacow)</td>
                                </tr>
                                <tr>
                                    <th scope="row">@swap</th>
                                    <td>/swap</td>
                                    <td>Swap file container (nodatacow)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


              
                <div id="overlay-fs">
                    <h3>Overlay Filesystem</h3>
                    <p>OverlayFS enables writable /etc on read-only root.</p>
                    
                    <div class="overlay-diagram">
                        <svg viewBox="0 0 700 400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="700" height="400" fill="#0b0618"/>
                            
                            <text x="350" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">Overlay Filesystem Structure</text>
                            
                            <!-- Lower Layer -->
                            <g>
                                <rect x="50" y="80" width="250" height="120" rx="8" fill="rgba(244,67,54,0.15)" stroke="#F44336" stroke-width="2"/>
                                <text x="175" y="105" text-anchor="middle" fill="#F44336" font-size="16" font-weight="bold">Lower Layer (Read-Only)</text>
                                <text x="175" y="130" text-anchor="middle" fill="#fca5a5" font-size="13">/etc from @blue/@green</text>
                                <text x="175" y="155" text-anchor="middle" fill="#fca5a5" font-size="12">Base system configs</text>
                                <circle cx="175" cy="180" r="8" fill="#F44336"/>
                                <text x="175" y="185" text-anchor="middle" fill="#fff" font-size="10">üîí</text>
                            </g>
                            
                            <!-- Upper Layer -->
                            <g>
                                <rect x="400" y="80" width="250" height="120" rx="8" fill="rgba(76,175,80,0.15)" stroke="#4CAF50" stroke-width="2"/>
                                <text x="525" y="105" text-anchor="middle" fill="#4CAF50" font-size="16" font-weight="bold">Upper Layer (Writable)</text>
                                <text x="525" y="130" text-anchor="middle" fill="#86efac" font-size="13">/data/overlay/etc/upper</text>
                                <text x="525" y="155" text-anchor="middle" fill="#86efac" font-size="12">Your changes stored here</text>
                                <circle cx="525" cy="180" r="8" fill="#4CAF50"/>
                                <text x="525" y="185" text-anchor="middle" fill="#fff" font-size="10">‚úèÔ∏è</text>
                            </g>
                            
                            <!-- Merged View -->
                            <g>
                                <rect x="200" y="250" width="300" height="120" rx="8" fill="rgba(33,150,243,0.15)" stroke="#2196F3" stroke-width="2"/>
                                <text x="350" y="275" text-anchor="middle" fill="#2196F3" font-size="16" font-weight="bold">Merged View (What you see)</text>
                                <text x="350" y="300" text-anchor="middle" fill="#93c5fd" font-size="13">/etc appears writable</text>
                                <text x="350" y="325" text-anchor="middle" fill="#93c5fd" font-size="12">Changes persist across updates</text>
                                <text x="350" y="345" text-anchor="middle" fill="#93c5fd" font-size="12">Original files remain untouched</text>
                            </g>
                            
                            <!-- Arrows -->
                            <line x1="175" y1="210" x2="280" y2="250" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-overlay)"/>
                            <line x1="525" y1="210" x2="420" y2="250" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow-overlay)"/>
                            
                            <defs>
                                <marker id="arrow-overlay" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Configuration changes persist while system files remain immutable</p>
                    </div>
                    
                    <div class="code-block">
                        <pre><code># /etc overlay mount
overlay /etc overlay rw,lowerdir=/etc,upperdir=/data/overlay/etc/upper,workdir=/data/overlay/etc/work 0 0</code></pre>
                    </div>

                    <h4>Overlay Directories</h4>
                    <p>Both /etc use overlay filesystems with this structure:</p>
                    <div class="code-block">
                        <pre><code>@data/overlay/etc/
  ‚îú‚îÄ‚îÄ lower/      # (unused, just structure)
  ‚îú‚îÄ‚îÄ upper/      # Your changes stored here
  ‚îî‚îÄ‚îÄ work/       # Overlay working directory</code></pre>
                    </div>
                    
                    <h4>Viewing Changes</h4>
                    <div class="code-block">
                        <pre><code># List all overlay modifications
ls -la /data/overlay/etc/upper

# Compare with base system
diff -r /etc /data/overlay/etc/upper</code></pre>
                    </div>

               
                <div id="boot-process">
                    <h3>Boot Process</h3>
                    <p>Understanding how ShaniOS boots:</p>
                    
                    <div class="boot-diagram">
                        <svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="900" height="600" fill="#0b0618"/>
                            
                            <text x="450" y="30" text-anchor="middle" fill="#ff8a5c" font-size="22" font-weight="bold">ShaniOS Boot Sequence</text>
                            
                            <!-- Step 1: UEFI -->
                            <g>
                                <rect x="50" y="70" width="800" height="70" rx="8" fill="rgba(156,39,176,0.15)" stroke="#9C27B0" stroke-width="2"/>
                                <circle cx="100" cy="105" r="20" fill="#9C27B0"/>
                                <text x="100" y="112" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">1</text>
                                <text x="140" y="95" fill="#d8b4fe" font-size="16" font-weight="bold">UEFI Firmware</text>
                                <text x="140" y="120" fill="#d8b4fe" font-size="13">Loads systemd-boot from ESP (/boot/efi)</text>
                            </g>
                            
                            <!-- Step 2: Bootloader -->
                            <g>
                                <rect x="50" y="160" width="800" height="70" rx="8" fill="rgba(33,150,243,0.15)" stroke="#2196F3" stroke-width="2"/>
                                <circle cx="100" cy="195" r="20" fill="#2196F3"/>
                                <text x="100" y="202" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">2</text>
                                <text x="140" y="185" fill="#93c5fd" font-size="16" font-weight="bold">systemd-boot</text>
                                <text x="140" y="210" fill="#93c5fd" font-size="13">Presents boot menu with @blue and @green entries</text>
                            </g>
                            
                            <!-- Step 3: Kernel -->
                            <g>
                                <rect x="50" y="250" width="800" height="70" rx="8" fill="rgba(255,152,0,0.15)" stroke="#FF9800" stroke-width="2"/>
                                <circle cx="100" cy="285" r="20" fill="#FF9800"/>
                                <text x="100" y="292" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">3</text>
                                <text x="140" y="275" fill="#fbbf24" font-size="16" font-weight="bold">Kernel Loading</text>
                                <text x="140" y="300" fill="#fbbf24" font-size="13">Boots selected Unified Kernel Image (UKI)</text>
                            </g>
                            
                            <!-- Step 4: Initramfs -->
                            <g>
                                <rect x="50" y="340" width="800" height="70" rx="8" fill="rgba(244,67,54,0.15)" stroke="#F44336" stroke-width="2"/>
                                <circle cx="100" cy="375" r="20" fill="#F44336"/>
                                <text x="100" y="382" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">4</text>
                                <text x="140" y="365" fill="#fca5a5" font-size="16" font-weight="bold">Initramfs</text>
                                <text x="140" y="390" fill="#fca5a5" font-size="13">Unlocks LUKS (if encrypted), mounts selected root subvolume</text>
                            </g>
                            
                            <!-- Step 5: systemd Init -->
                            <g>
                                <rect x="50" y="430" width="800" height="70" rx="8" fill="rgba(76,175,80,0.15)" stroke="#4CAF50" stroke-width="2"/>
                                <circle cx="100" cy="465" r="20" fill="#4CAF50"/>
                                <text x="100" y="472" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">5</text>
                                <text x="140" y="455" fill="#86efac" font-size="16" font-weight="bold">systemd Init & Filesystem Setup</text>
                                <text x="140" y="480" fill="#86efac" font-size="13">Root read-only, /var tmpfs, /etc overlay, persistent mounts, services start</text>
                            </g>
                            
                            <!-- Step 6: Desktop -->
                            <g>
                                <rect x="50" y="520" width="800" height="70" rx="8" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                                <circle cx="100" cy="555" r="20" fill="#8b5cf6"/>
                                <text x="100" y="562" text-anchor="middle" fill="#fff" font-size="16" font-weight="bold">6</text>
                                <text x="140" y="545" fill="#c4b5fd" font-size="16" font-weight="bold">Desktop Environment</text>
                                <text x="140" y="570" fill="#c4b5fd" font-size="13">GNOME or KDE Plasma launches ‚Üí Ready to use!</text>
                            </g>
                        </svg>
                        <p class="caption">Six-stage boot process from firmware to desktop</p>
                    </div>
                </div>
                
                        <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Important Notes:</strong></p>
                            <ul>
                                <li>Dual booting not recommended (other OSes may break bootloader)</li>
                                <li>Use Flatpak, containers, or AppImages for software</li>
                                <li>Root filesystem is immutable by design</li>
                            </ul>
                        </div>
                    </div>
                    <h4>Bootloader Configuration</h4>
                    <p>ShaniOS uses systemd-boot with Unified Kernel Images (UKI):</p>
                    <ul>
                        <li><strong>Timeout:</strong> 5 seconds</li>
                        <li><strong>Console mode:</strong> Maximum resolution</li>
                        <li><strong>Editor:</strong> Disabled for security (prevents boot parameter tampering)</li>
                        <li><strong>Default entry:</strong> Current active slot (@blue or @green)</li>
                    </ul>

                    <h4>Boot Entry Naming</h4>
                    <p>Boot menu entries clearly show system state:</p>
                    <ul>
                        <li><strong>shanios-blue (Active):</strong> Currently running system</li>
                        <li><strong>shanios-green (Candidate):</strong> Standby system for next update</li>
                    </ul>
                    <p>After an update, the labels switch automatically.</p>

                    <h4>UEFI Boot Entry</h4>
                    <p>ShaniOS creates a UEFI boot entry during installation:</p>
                    <ul>
                        <li><strong>Label:</strong> shanios</li>
                        <li><strong>Loader:</strong> \EFI\BOOT\BOOTX64.EFI (Shim for Secure Boot)</li>
                        <li><strong>Fallback:</strong> Boot entry creation failures don't stop installation</li>
                    </ul>

                    <h4>Shim and Secure Boot Chain</h4>
                    <p>The boot chain when Secure Boot is enabled:</p>
                    <div class="code-block">
                        <pre><code>UEFI Firmware
    ‚Üì
shimx64.efi (signed by Microsoft, validates next stage)
    ‚Üì
grubx64.efi (actually systemd-boot, signed by MOK)
    ‚Üì
Unified Kernel Image (signed by MOK)
    ‚Üì
Linux Kernel + Initramfs</code></pre>
                    </div>

                    <h4>Kernel Command Line</h4>
                    <p>ShaniOS uses these boot parameters:</p>
                    <div class="code-block">
                        <pre><code>quiet splash systemd.volatile=state ro 
lsm=landlock,lockdown,yama,integrity,apparmor,bpf 
rootfstype=btrfs 
rootflags=subvol=@blue,ro,noatime,compress=zstd,space_cache=v2,autodefrag
root=/dev/mapper/shani_root  # If encrypted
rd.luks.uuid=... rd.luks.name=... rd.luks.options=tpm2-device=auto  # If TPM enrolled
resume=UUID=... resume_offset=...  # If swapfile exists</code></pre>
                    </div>

                    <h4>Kernel Hardening</h4>
                    <p>Security-focused kernel parameters are enabled by default:</p>
                    <div class="code-block">
                        <pre><code>lsm=landlock,lockdown,yama,integrity,apparmor,bpf</code></pre>
                    </div>
                    <p>This enables multiple Linux Security Modules for layered protection:</p>
                    <ul>
                        <li><strong>Landlock:</strong> Sandboxing for unprivileged processes</li>
                        <li><strong>Lockdown:</strong> Restricts kernel access from userspace</li>
                        <li><strong>Yama:</strong> Ptrace restrictions to prevent debugging attacks</li>
                        <li><strong>Integrity:</strong> File integrity measurement</li>
                        <li><strong>AppArmor:</strong> Mandatory Access Control profiles</li>
                        <li><strong>BPF:</strong> Secure BPF program loading</li>
                    </ul>

                    <h4>Kernel Parameter: systemd.volatile=state</h4>
                    <p>The <code>systemd.volatile=state</code> kernel parameter creates a tmpfs (RAM-based) overlay for /var, making it volatile by default:</p>
                    <div class="code-block">
                        <pre><code># From kernel command line
systemd.volatile=state

# Result: /var is tmpfs, cleared on every reboot
# Only explicitly mounted subdirectories persist</code></pre>
                    </div>

                    <h4>Hibernation Support</h4>
                    <p>ShaniOS automatically configures hibernation if a swapfile is created:</p>
                    <ul>
                        <li><strong>Swapfile location:</strong> /swap/swapfile (in @swap subvolume)</li>
                        <li><strong>Size:</strong> Equal to RAM (or less if disk space limited)</li>
                        <li><strong>Resume offset:</strong> Automatically calculated using <code>btrfs inspect-internal map-swapfile</code></li>
                        <li><strong>Btrfs CoW:</strong> Disabled on @swap subvolume for reliability</li>
                    </ul>

                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Disk Space for Swapfile:</strong> If available disk space is less than RAM size, swapfile creation is skipped and the system uses zram for swap instead. Hibernation will not be available in this case.</p>
                        </div>
                    </div>
           

                </div>
            </section>

            <!-- USING SHANIOS -->
            <section id="daily-use" class="wiki-section">
                <h2>Using ShaniOS</h2>
                
                <div id="system-updates">
                    <h3>System Updates</h3>
                    
                    <h4>Automatic Update Checker</h4>
                    <p>ShaniOS includes a background service that automatically checks for updates:</p>
                    <ul>
                        <li><strong>shani-update:</strong> Runs periodically via systemd user timer</li>
                        <li>Checks SourceForge for new releases matching your system profile</li>
                        <li>Notifies you when updates are available</li>
                        <li>Provides user-friendly GUI dialogs for update approval</li>
                        <li>Automatically launches terminal-based update installer</li>
                    </ul>

                    <h4>Manual Update</h4>
                    <div class="code-block">
                        <pre><code>sudo shani-deploy</code></pre>
                    </div>
                    
                    <p>The update process includes:</p>
                    <ol>
                        <li>Prerequisites check (root access, internet, disk space)</li>
                        <li>Power management (prevents sleep/shutdown)</li>
                        <li>Boot validation (verifies current @blue or @green state)</li>
                        <li>Mirror discovery (finds fastest SourceForge mirror)</li>
                        <li>Intelligent download with resume support</li>
                        <li>Verification (SHA256 checksum and GPG signature)</li>
                        <li>Deployment to inactive subvolume</li>
                        <li>UKI generation for both slots</li>
                        <li>Bootloader update</li>
                        <li>Configuration migration</li>
                    </ol>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Automatic Rollback:</strong> If the updated system fails to boot, ShaniOS automatically reverts to the previous working state on next startup. The boot-success marker system tracks successful boots.</p>
                        </div>
                    </div>

                    <h4>Update Channels</h4>
                    <p>ShaniOS supports multiple update channels:</p>
                    <ul>
                        <li><strong>stable (default):</strong> Thoroughly tested releases</li>
                        <li><strong>latest:</strong> Newest features (may be less stable)</li>
                    </ul>
                    <p>Set your preferred channel:</p>
                    <div class="code-block">
                        <pre><code># Choose channel
sudo shani-deploy -t latest

# Or set permanently
echo "latest" | sudo tee /etc/shani-channel</code></pre>
                    </div>

                    <h4>Update Options</h4>
                    <div class="code-block">
                        <pre><code># Show help
sudo shani-deploy --help

# Force rollback to previous version
sudo shani-deploy --rollback

# Manual cleanup of old backups and downloads
sudo shani-deploy --cleanup

# Storage analysis with deduplication
sudo shani-deploy --storage-info

# Dry run (simulate without changes)
sudo shani-deploy --dry-run

# Verbose output for troubleshooting
sudo shani-deploy --verbose</code></pre>
                    </div>

                    <h4>Other Updates</h4>
                    <div class="code-block">
                        <pre><code># Update Flatpak applications
flatpak update

# Update firmware via LVFS
fwupdmgr refresh
fwupdmgr update</code></pre>
                    </div>
                </div>
                
                <div id="software-management">
                    <h3>Software Management</h3>
                    <p>ShaniOS uses Flatpak as the primary application delivery method, with containers for development tools and system-level software.</p>

                    <div class="software-flow">
                        <svg viewBox="0 0 1000 350" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <rect width="1000" height="350" fill="#0b0618"/>
                            
                            <text x="500" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">Software Installation Methods</text>
                            
                            <!-- Flatpak -->
                            <g>
                                <rect x="50" y="70" width="280" height="240" rx="10" fill="rgba(33,150,243,0.15)" stroke="#2196F3" stroke-width="2"/>
                                <text x="190" y="100" text-anchor="middle" fill="#2196F3" font-size="16" font-weight="bold">üì¶ Flatpak Apps</text>
                                
                                <text x="190" y="135" text-anchor="middle" fill="#93c5fd" font-size="14" font-weight="600">Best For:</text>
                                <text x="190" y="160" text-anchor="middle" fill="#93c5fd" font-size="12">Desktop applications</text>
                                <text x="190" y="180" text-anchor="middle" fill="#93c5fd" font-size="12">Web browsers</text>
                                <text x="190" y="200" text-anchor="middle" fill="#93c5fd" font-size="12">Office suites</text>
                                <text x="190" y="220" text-anchor="middle" fill="#93c5fd" font-size="12">Media players</text>
                                
                                <text x="190" y="255" text-anchor="middle" fill="#60a5fa" font-size="13" font-weight="600">Sandboxed & Isolated</text>
                                <text x="190" y="280" text-anchor="middle" fill="#60a5fa" font-size="11">Install: flatpak install ...</text>
                            </g>
                            
                            <!-- Containers -->
                            <g>
                                <rect x="360" y="70" width="280" height="240" rx="10" fill="rgba(156,39,176,0.15)" stroke="#9C27B0" stroke-width="2"/>
                                <text x="500" y="100" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="bold">üê≥ Containers</text>
                                
                                <text x="500" y="135" text-anchor="middle" fill="#d8b4fe" font-size="14" font-weight="600">Best For:</text>
                                <text x="500" y="160" text-anchor="middle" fill="#d8b4fe" font-size="12">Development tools</text>
                                <text x="500" y="180" text-anchor="middle" fill="#d8b4fe" font-size="12">CLI utilities</text>
                                <text x="500" y="200" text-anchor="middle" fill="#d8b4fe" font-size="12">Build environments</text>
                                <text x="500" y="220" text-anchor="middle" fill="#d8b4fe" font-size="12">Testing software</text>
                                
                                <text x="500" y="255" text-anchor="middle" fill="#c084fc" font-size="13" font-weight="600">Full Linux Environment</text>
                                <text x="500" y="280" text-anchor="middle" fill="#c084fc" font-size="11">Use: distrobox, podman, lxc</text>
                            </g>
                            
                            <!-- AppImage -->
                            <g>
                                <rect x="670" y="70" width="280" height="240" rx="10" fill="rgba(255,152,0,0.15)" stroke="#FF9800" stroke-width="2"/>
                                <text x="810" y="100" text-anchor="middle" fill="#FF9800" font-size="16" font-weight="bold">üìÑ AppImage</text>
                                
                                <text x="810" y="135" text-anchor="middle" fill="#fbbf24" font-size="14" font-weight="600">Best For:</text>
                                <text x="810" y="160" text-anchor="middle" fill="#fbbf24" font-size="12">Portable apps</text>
                                <text x="810" y="180" text-anchor="middle" fill="#fbbf24" font-size="12">One-time tools</text>
                                <text x="810" y="200" text-anchor="middle" fill="#fbbf24" font-size="12">Apps not in Flatpak</text>
                                <text x="810" y="220" text-anchor="middle" fill="#fbbf24" font-size="12">Beta software</text>
                                
                                <text x="810" y="255" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="600">Self-Contained</text>
                                <text x="810" y="280" text-anchor="middle" fill="#fb923c" font-size="11">Run: chmod +x && ./app.AppImage</text>
                            </g>
                        </svg>
                        <p class="caption">Choose the right installation method for your needs</p>
                    </div>

                    <h4>Managing Applications via GUI</h4>
                    <ul>
                        <li><strong>GNOME:</strong> Use GNOME Software for graphical app management</li>
                        <li><strong>KDE:</strong> Use Discover for browsing and installing Flatpaks</li>
                        <li><strong>Both:</strong> Support Flathub integration out of the box</li>
                    </ul>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>No pacman:</strong> Traditional package management via pacman is not supported. The base system is immutable. Use Flatpak, containers, or AppImages for applications.</p>
                        </div>
                    </div>
                </div>
                    
                    <h4>Installing Flatpak Applications</h4>
                    <div class="code-block">
                        <pre><code># Search for applications
flatpak search keyword

# Install from Flathub
flatpak install flathub org.application.Name

# List installed apps
flatpak list

# Remove an app
flatpak uninstall org.application.Name</code></pre>
                    </div>
                                       
                    <h4>Gaming</h4>
                    <p><strong>Game Launchers:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub com.valvesoftware.Steam
flatpak install flathub com.heroicgameslauncher.hgl
flatpak install flathub net.lutris.Lutris
flatpak install flathub org.libretro.RetroArch</code></pre>
                    </div>
                    
                    <p><strong>Gaming Peripherals:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub io.github.antimicrox.antimicrox  # Gamepad mapper
flatpak install flathub org.freedesktop.Piper            # Mouse configuration
flatpak install flathub org.openrgb.OpenRGB              # RGB lighting</code></pre>
                    </div>
                    
                    <p><strong>Performance Tools:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub io.github.benjamimgois.goverlay  # Overlay manager
flatpak install flathub org.freedesktop.Platform.VulkanLayer.MangoHud
flatpak install flathub org.freedesktop.Platform.VulkanLayer.gamescope</code></pre>
                    </div>

                    <h4>Windows Applications</h4>
                    <p>Run Windows apps using Wine via Bottles:</p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub com.usebottles.bottles</code></pre>
                    </div>

                    <h4>Using Containers for Development</h4>
                    <p><strong>Distrobox (Recommended for CLI tools):</strong></p>
                    <div class="code-block">
                        <pre><code># Create Ubuntu environment
distrobox create --name ubuntu --image ubuntu:22.04

# Enter environment
distrobox enter ubuntu

# Inside container, install anything with apt
sudo apt update && sudo apt install build-essential nodejs python3</code></pre>
                    </div>

                    <p><strong>Podman (Docker-compatible):</strong></p>
                    <div class="code-block">
                        <pre><code># Run container
podman run -it --rm ubuntu:22.04 bash

# Docker Compose style
podman compose up -d</code></pre>
                    </div>
                    
                    <p><strong>LXC System Containers:</strong></p>
                    <div class="code-block">
                        <pre><code>lxc launch images:ubuntu/22.04 my-container</code></pre>
                    </div>

                    <h4>Android Applications</h4>
                    <p>Waydroid is pre-installed. Launch from Applications menu and complete setup wizard.</p>


                    <h4>Editing System Configuration</h4>
                    <p>The /etc directory uses overlay filesystem, allowing modifications:</p>
                    <div class="code-block">
                        <pre><code># Edit system configuration
sudo nano /etc/some-config-file

# Changes are stored in /data/overlay/etc/upper
# and persist across system updates</code></pre>
                    </div>



                


            <!-- WEBHOSTING -->
            <section id="webhosting" class="wiki-section">
                <h2>Webhosting</h2>

                <div id="web-hosting">
                    <h3>Web Hosting & Networking</h3>
                    <p>ShaniOS lets you host websites and services directly from your desktop or laptop‚Äîeven on home internet connections without a static IP. All tools listed here are <strong>installed for convenience</strong> and are <strong>not enabled or running by default</strong>.</p>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="note-content">
                            <p><strong>Security First:</strong> These services are disabled by default. Only enable what you need, and always configure firewall rules appropriately. Never expose services publicly without understanding the security implications.</p>
                        </div>
                    </div>

                    <h4>How Desktop Web Hosting Works</h4>
                    
                    <div class="webhost-diagram">
                        <svg viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <!-- Background -->
                            <rect width="1200" height="500" fill="#0b0618"/>
                            
                            <!-- Title -->
                            <text x="600" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">Desktop Web Hosting Architecture</text>
                            
                            <!-- Your Desktop / Laptop -->
                            <g>
                                <rect x="50" y="100" width="220" height="120" rx="12" fill="rgba(76,175,80,0.15)" stroke="#4CAF50" stroke-width="2.5"/>
                                <text x="160" y="125" text-anchor="middle" fill="#fff" font-size="24">üíª</text>
                                <text x="160" y="150" text-anchor="middle" fill="#4CAF50" font-size="16" font-weight="bold">Your Desktop/Laptop</text>
                                <text x="160" y="170" text-anchor="middle" fill="#86efac" font-size="13">Caddy Web Server</text>
                                <text x="160" y="188" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Hosting your content</text>
                                <text x="160" y="205" text-anchor="middle" fill="rgba(248,247,252,0.5)" font-size="11">localhost:8080</text>
                            </g>

                            <!-- firewalld -->
                            <g>
                                <rect x="320" y="100" width="200" height="120" rx="12" fill="rgba(244,67,54,0.15)" stroke="#F44336" stroke-width="2.5"/>
                                <text x="420" y="125" text-anchor="middle" fill="#fff" font-size="24">üõ°Ô∏è</text>
                                <text x="420" y="150" text-anchor="middle" fill="#F44336" font-size="16" font-weight="bold">firewalld</text>
                                <text x="420" y="170" text-anchor="middle" fill="#fca5a5" font-size="13">Host Firewall</text>
                                <text x="420" y="188" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Controls traffic flow</text>
                                <text x="420" y="205" text-anchor="middle" fill="rgba(248,247,252,0.5)" font-size="11">Blocks/permits ports</text>
                            </g>

                            <!-- Public Path - Cloudflared -->
                            <g>
                                <rect x="570" y="60" width="240" height="140" rx="12" fill="rgba(33,150,243,0.15)" stroke="#2196F3" stroke-width="2.5"/>
                                <text x="690" y="85" text-anchor="middle" fill="#fff" font-size="24">üåê</text>
                                <text x="690" y="110" text-anchor="middle" fill="#2196F3" font-size="16" font-weight="bold">Cloudflared Tunnel</text>
                                <text x="690" y="130" text-anchor="middle" fill="#93c5fd" font-size="13">Encrypted Outbound Tunnel</text>
                                <text x="690" y="148" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">No port forwarding needed</text>
                                <text x="690" y="166" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Hides your real IP</text>
                                <text x="690" y="184" text-anchor="middle" fill="#60a5fa" font-size="11" font-weight="600">PUBLIC ACCESS üåç</text>
                            </g>

                            <!-- Public Internet -->
                            <g>
                                <rect x="860" y="60" width="200" height="140" rx="12" fill="rgba(255,152,0,0.15)" stroke="#FF9800" stroke-width="2.5"/>
                                <text x="960" y="85" text-anchor="middle" fill="#fff" font-size="24">üåç</text>
                                <text x="960" y="110" text-anchor="middle" fill="#FF9800" font-size="16" font-weight="bold">Public Internet</text>
                                <text x="960" y="130" text-anchor="middle" fill="#fbbf24" font-size="13">Anyone with URL</text>
                                <text x="960" y="148" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">yoursite.example.com</text>
                                <text x="960" y="166" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Automatic HTTPS</text>
                                <text x="960" y="184" text-anchor="middle" fill="#fb923c" font-size="11" font-weight="600">WORLD ACCESSIBLE üåê</text>
                            </g>

                            <!-- Private Path - Tailscale -->
                            <g>
                                <rect x="570" y="260" width="240" height="140" rx="12" fill="rgba(156,39,176,0.15)" stroke="#9C27B0" stroke-width="2.5"/>
                                <text x="690" y="285" text-anchor="middle" fill="#fff" font-size="24">üîê</text>
                                <text x="690" y="310" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="bold">Tailscale VPN</text>
                                <text x="690" y="330" text-anchor="middle" fill="#d8b4fe" font-size="13">Private Mesh Network</text>
                                <text x="690" y="348" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">WireGuard encrypted</text>
                                <text x="690" y="366" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Peer-to-peer when possible</text>
                                <text x="690" y="384" text-anchor="middle" fill="#c084fc" font-size="11" font-weight="600">PRIVATE ONLY üîí</text>
                            </g>

                            <!-- Your Devices -->
                            <g>
                                <rect x="860" y="260" width="200" height="140" rx="12" fill="rgba(96,125,139,0.15)" stroke="#607D8B" stroke-width="2.5"/>
                                <text x="960" y="285" text-anchor="middle" fill="#fff" font-size="24">üì±</text>
                                <text x="960" y="310" text-anchor="middle" fill="#607D8B" font-size="16" font-weight="bold">Your Devices</text>
                                <text x="960" y="330" text-anchor="middle" fill="#cbd5e1" font-size="13">Phone ¬∑ Tablet ¬∑ Laptop</text>
                                <text x="960" y="348" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">On Tailscale network</text>
                                <text x="960" y="366" text-anchor="middle" fill="rgba(248,247,252,0.7)" font-size="12">Access privately</text>
                                <text x="960" y="384" text-anchor="middle" fill="#94a3b8" font-size="11" font-weight="600">AUTHORIZED ONLY üîê</text>
                            </g>

                            <!-- Connection Arrows -->
                            <defs>
                                <marker id="arrow-public" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#2196F3"/>
                                </marker>
                                <marker id="arrow-private" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#9C27B0"/>
                                </marker>
                            </defs>

                            <!-- Desktop ‚Üí Firewall -->
                            <path d="M270,160 H320" fill="none" stroke="#4CAF50" stroke-width="3"/>
                            
                            <!-- Firewall ‚Üí Cloudflared (Public Path) -->
                            <path d="M520,130 H570" fill="none" stroke="#2196F3" stroke-width="3" marker-end="url(#arrow-public)"/>
                            <text x="545" y="120" text-anchor="middle" fill="#60a5fa" font-size="11" font-weight="600">PUBLIC</text>
                            
                            <!-- Cloudflared ‚Üí Internet -->
                            <path d="M810,130 H860" fill="none" stroke="#FF9800" stroke-width="3"/>
                            
                            <!-- Firewall ‚Üí Tailscale (Private Path) -->
                            <path d="M520,190 Q545,225 570,330" fill="none" stroke="#9C27B0" stroke-width="3" marker-end="url(#arrow-private)"/>
                            <text x="540" y="260" text-anchor="middle" fill="#c084fc" font-size="11" font-weight="600">PRIVATE</text>
                            
                            <!-- Tailscale ‚Üí Devices -->
                            <path d="M810,330 H860" fill="none" stroke="#607D8B" stroke-width="3"/>

                            <!-- Legend -->
                            <g>
                                <rect x="50" y="440" width="1100" height="45" rx="8" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                                
                                <circle cx="150" cy="462" r="6" fill="#2196F3"/>
                                <text x="165" y="467" fill="#93c5fd" font-size="12">
                                    <tspan font-weight="600">Cloudflared:</tspan> Public HTTPS access ¬∑ No static IP needed ¬∑ Hides your home IP
                                </text>
                                
                                <circle cx="650" cy="462" r="6" fill="#9C27B0"/>
                                <text x="665" y="467" fill="#d8b4fe" font-size="12">
                                    <tspan font-weight="600">Tailscale:</tspan> Private VPN ¬∑ Only authorized devices ¬∑ Peer-to-peer mesh
                                </text>
                            </g>
                        </svg>
                        <p class="caption">Two secure paths: üåê Public access via Cloudflared tunnel, üîê Private access via Tailscale VPN</p>
                    </div>

                    <h4>Pre-installed Networking Tools</h4>

                    <div class="feature-grid">
                        <article class="feature-card">
                            <i class="fas fa-server feature-icon"></i>
                            <h3>Caddy Web Server</h3>
                            <p>Modern, lightweight web server with automatic HTTPS for hosting sites from your desktop. Caddy makes it easy to host personal websites, dashboards, or file servers. It is <strong>not active by default</strong> and runs only when you start and configure it.</p>
                            <p><strong>Start Caddy:</strong></p>
                            <div class="code-block">
                                <pre><code>sudo systemctl start caddy
sudo systemctl enable caddy  # Auto-start on boot</code></pre>
                            </div>
                            <p>Ideal for web-hosting directly from your desktop without needing a dedicated server.</p>
                        </article>

                        <article class="feature-card">
                            <i class="fas fa-cloud feature-icon"></i>
                            <h3>Cloudflared</h3>
                            <p>Cloudflared creates an encrypted tunnel to Cloudflare, allowing public HTTPS access to services running on your desktop. It is <strong>disabled by default</strong> and requires manual setup.</p>
                            <p><strong>Setup:</strong></p>
                            <div class="code-block">
                                <pre><code># Login to Cloudflare
cloudflared tunnel login

# Create tunnel
cloudflared tunnel create my-tunnel

# Configure tunnel (edit config file)
sudo nano ~/.cloudflared/config.yml

# Example config:
# tunnel: YOUR-TUNNEL-ID
# credentials-file: /home/USER/.cloudflared/YOUR-TUNNEL-ID.json
# 
# ingress:
#   - hostname: mysite.example.com
#     service: http://localhost:8080
#   - service: http_status:404

# Start tunnel
cloudflared tunnel run my-tunnel

# Enable as service
sudo cloudflared service install
sudo systemctl start cloudflared
sudo systemctl enable cloudflared</code></pre>
                            </div>
                            <p><strong>Firewall Configuration:</strong></p>
                            <div class="code-block">
                                <pre><code># Cloudflared creates OUTBOUND connections only
# No inbound ports need to be opened in firewall
# This is the security advantage of tunnels!

# Verify outbound connections are allowed (default)
sudo firewall-cmd --list-all

# If you have strict outbound rules, allow HTTPS
sudo firewall-cmd --add-service=https --permanent
sudo firewall-cmd --reload</code></pre>
                            </div>
                            <p>Perfect for hosting websites on home connections or behind NAT/CGNAT, without exposing your real IP address or opening inbound firewall ports.</p>
                            <div class="note-box" role="note">
                                <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                                <div class="note-content">
                                    <p><strong>Security Advantage:</strong> Cloudflared tunnels are outbound-only connections, meaning you don't need to open any inbound ports in your firewall. This significantly reduces attack surface while still providing public HTTPS access.</p>
                                </div>
                            </div>
                        </article>

                        <article class="feature-card">
                            <i class="fas fa-network-wired feature-icon"></i>
                            <h3>Tailscale</h3>
                            <p>Tailscale creates a private encrypted network between your devices using WireGuard. It is <strong>not active unless you sign in and enable it</strong>.</p>
                            <p><strong>Setup:</strong></p>
                            <div class="code-block">
                                <pre><code># Start Tailscale
sudo systemctl start tailscaled
sudo systemctl enable tailscaled

# Login and connect
sudo tailscale up

# Check status
tailscale status

# Allow Tailscale in firewall (UDP 41641)
sudo firewall-cmd --add-port=41641/udp --permanent
sudo firewall-cmd --reload</code></pre>
                            </div>
                            <p>Use it to access your hosted websites and services privately, without making them public on the internet.</p>
                            <div class="note-box" role="note">
                                <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                                <div class="note-content">
                                    <p><strong>Firewall Note:</strong> Tailscale works even without opening ports (NAT traversal), but opening UDP 41641 improves direct peer-to-peer connectivity.</p>
                                </div>
                            </div>
                        </article>

                        <article class="feature-card">
                            <i class="fas fa-terminal feature-icon"></i>
                            <h3>OpenSSH</h3>
                            <p>OpenSSH provides industry-standard encrypted remote access and file transfer (SSH, SCP, SFTP). The SSH server is <strong>not enabled by default</strong>.</p>
                            <p><strong>Enable SSH Server:</strong></p>
                            <div class="code-block">
                                <pre><code>sudo systemctl start sshd
sudo systemctl enable sshd

# Configure (optional)
sudo nano /etc/ssh/sshd_config

# Restart after changes
sudo systemctl restart sshd

# Allow SSH through firewall (for local/Tailscale access)
sudo firewall-cmd --add-service=ssh --permanent
sudo firewall-cmd --reload</code></pre>
                            </div>
                            <p>Useful for managing your desktop-hosted websites locally, over Tailscale, or through secure tunnels.</p>
                            <div class="warning-box" role="alert">
                                <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                <div class="warning-content">
                                    <p><strong>Security Warning:</strong> Never expose SSH directly to the public internet. Use SSH over Tailscale, or tunnel it through Cloudflared. If you must expose SSH publicly, always use key-based authentication, disable password auth, change the default port, and enable Fail2ban.</p>
                                </div>
                            </div>
                        </article>

                        <article class="feature-card">
                            <i class="fas fa-shield-alt feature-icon"></i>
                            <h3>Fail2ban</h3>
                            <p>Fail2ban monitors authentication logs and temporarily blocks abusive IP addresses using firewall rules. It is <strong>not enabled by default</strong>.</p>
                            <p><strong>Enable Fail2ban:</strong></p>
                            <div class="code-block">
                                <pre><code>sudo systemctl start fail2ban
sudo systemctl enable fail2ban

# Check status
sudo fail2ban-client status

# View SSH jail status
sudo fail2ban-client status sshd</code></pre>
                            </div>
                            <p><strong>Firewall Integration:</strong></p>
                            <div class="code-block">
                                <pre><code># Fail2ban automatically integrates with firewalld
# No manual firewall rules needed

# Verify Fail2ban can control firewall
sudo firewall-cmd --get-active-zones
sudo fail2ban-client status

# Check banned IPs
sudo firewall-cmd --direct --get-all-rules</code></pre>
                            </div>
                            <p>Recommended when exposing services such as SSH or web applications to the public, adding an extra layer of protection against brute-force attacks.</p>
                            <div class="note-box" role="note">
                                <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                                <div class="note-content">
                                    <p><strong>How it works:</strong> Fail2ban monitors logs for failed login attempts and automatically adds temporary firewall rules to block attacking IP addresses. It integrates directly with firewalld‚Äîno manual configuration needed.</p>
                                </div>
                            </div>
                        </article>

                        <article class="feature-card">
                            <i class="fas fa-fire feature-icon"></i>
                            <h3>firewalld</h3>
                            <p>firewalld provides a dynamic firewall with zones and services to control inbound and outbound network traffic. It is <strong>active by default</strong> with restrictive rules.</p>
                            <p><strong>Common Commands:</strong></p>
                            <div class="code-block">
                                <pre><code># Check status
sudo firewall-cmd --state

# List active rules
sudo firewall-cmd --list-all

# Open HTTP/HTTPS
sudo firewall-cmd --add-service=http --permanent
sudo firewall-cmd --add-service=https --permanent
sudo firewall-cmd --reload

# Open custom port
sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload</code></pre>
                            </div>
                            <p>Use it to restrict access to your hosted websites, SSH, and other services, ensuring that only allowed connections reach your desktop.</p>
                        </article>
                    </div>

                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>Security Best Practices:</strong></p>
                            <ul>
                                <li><strong>Use Tailscale first:</strong> Private access whenever possible instead of exposing services publicly</li>
                                <li><strong>Never expose SSH directly:</strong> Use Tailscale or Cloudflared tunnel, never open port 22 to internet</li>
                                <li><strong>Cloudflared for public access:</strong> Safest way to expose web services‚Äîno inbound firewall ports needed</li>
                                <li><strong>Configure firewalld properly:</strong>
                                    <ul>
                                        <li>Cloudflared: No inbound ports needed (outbound only)</li>
                                        <li>Tailscale: Optionally open UDP 41641 for better performance</li>
                                        <li>SSH: Only allow via firewall for local/Tailscale networks, never public</li>
                                        <li>Caddy: Only open HTTP (80) and HTTPS (443) if needed locally</li>
                                    </ul>
                                </li>
                                <li><strong>Enable Fail2ban:</strong> Essential protection when running publicly accessible services</li>
                                <li><strong>Keep everything updated:</strong> Regular updates with <code>sudo shani-deploy</code></li>
                                <li><strong>Strong authentication:</strong> Use strong passwords or SSH key authentication (disable password auth for SSH)</li>
                                <li><strong>Monitor logs:</strong> Regularly check <code>sudo journalctl -u sshd</code> and <code>sudo journalctl -u caddy</code></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TROUBLESHOOTING -->
            <section id="troubleshooting" class="wiki-section">
                <h2>Troubleshooting</h2>
                
                <h3>Boot Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>System won't boot after update</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS should automatically rollback. If not:</p>
                            <ol>
                                <li>At boot menu, select the previous entry (@blue or @green)</li>
                                <li>System will boot to last known working state</li>
                                <li>Report issue via GitHub or Telegram</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>LUKS password not working after TPM enrollment</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>TPM enrollment adds a new unlock method but preserves your password. If experiencing issues:</p>
                            <ol>
                                <li>Wait a few seconds at the unlock prompt</li>
                                <li>Try entering password again</li>
                                <li>If persistent, boot from live USB and remove TPM enrollment using chroot</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <h3>Update Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>shani-deploy fails with network error</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Check network connectivity:</p>
                            <div class="code-block">
                                <pre><code># Test connectivity
ping -c 3 shani.dev

# Check NetworkManager
systemctl status NetworkManager

# Retry update
sudo shani-deploy</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3>Application Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>Flatpak app won't start</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Try these steps:</p>
                            <div class="code-block">
                                <pre><code># Update Flatpak
flatpak update

# Repair installation
flatpak repair

# Check permissions
flatpak override --show org.app.Name

# Reset all overrides for the app
flatpak override --reset org.app.Name

# Run from terminal to see errors
flatpak run org.app.Name

# Check GPU / graphics issues (common for Electron & games)
flatpak run --env=LIBGL_DEBUG=verbose org.app.Name</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3>Encryption & LUKS Issues</h3>
                <div class="faq-container">                 
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>How to check if my system is encrypted</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <div class="code-block">
                                <pre><code># Method 1: Check for active LUKS mapping
sudo cryptsetup status shani_root
# If encrypted, shows: "is active" with device info

# Method 2: Check for crypto_LUKS partitions
sudo blkid | grep crypto_LUKS
# Shows all LUKS encrypted partitions

# Method 3: Check mounted devices
mount | grep mapper
# If encrypted, shows: /dev/mapper/shani_root

# Method 4: List block devices with filesystem types
lsblk -f
# Look for TYPE="crypto_LUKS"

# If none of these show encryption, your system is NOT encrypted
# and you cannot use TPM enrollment</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>Remove TPM enrollment and return to password-only</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <div class="code-block">
                                <pre><code># Get your LUKS device
LUKS_DEVICE=$(sudo cryptsetup status shani_root | grep device: | awk '{print $2}')

# Remove TPM enrollment
sudo systemd-cryptenroll --wipe-slot=tpm2 "$LUKS_DEVICE"

# Regenerate boot images
sudo gen-efi configure blue
sudo gen-efi configure green

# Done - system will now require password on boot</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ -->
            <section id="faq" class="wiki-section">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I install traditional Arch packages with pacman?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>No. The root filesystem is read-only and immutable by design. This is a core security and stability feature, not a limitation. Use Flatpak for GUI applications, and containers (Distrobox, Podman) for development tools and CLI utilities.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>What happens if an update fails?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS includes automatic boot failure detection. If the system fails to boot after an update, it automatically reverts to the previous working image on the next boot attempt. No manual intervention required.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Does ShaniOS support hibernation?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Yes. ShaniOS uses a dedicated @swap subvolume with Copy-on-Write disabled, providing reliable hibernation on Btrfs. This approach solves the traditional Btrfs hibernation challenges.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How do I make persistent changes to system configuration?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>The /etc directory uses overlay filesystem, making it writable despite the read-only root. Simply edit files in /etc normally‚Äîchanges are stored in /data/overlay/etc/upper and persist across updates and blue-green switches.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Why does ShaniOS need 32GB minimum storage?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS maintains two complete system images (@blue and @green) for atomic updates. However, Btrfs Copy-on-Write shares unchanged data between them, resulting in only ~18% overhead. The benefit is zero-downtime updates and instant rollback capability.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I use ShaniOS on legacy BIOS systems?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>No. ShaniOS requires UEFI firmware for features like Unified Kernel Images (UKIs), Secure Boot support, and the systemd-boot bootloader. Legacy BIOS is not supported.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I dual-boot ShaniOS with Windows or another Linux?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Not recommended. Other operating systems may modify the bootloader or ESP partition, potentially breaking ShaniOS boot entries. For running other systems, use virtual machines (QEMU/KVM) or containers instead.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How do I switch between @blue and @green manually?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>At the systemd-boot menu during startup, select the alternative boot entry. Both @blue and @green entries are always available, allowing instant rollback or testing.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CONTRIBUTE -->
            <section id="contribute" class="wiki-section">
                <h2>Contribute</h2>
                <p>ShaniOS is open-source and welcomes community contributions.</p>
                
                <div class="contribute-options">
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fab fa-github"></i></div>
                        <h3>Code Contributions</h3>
                        <p>Contribute to core development, tools, or installer</p>
                        <a href="https://github.com/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">GitHub</a>
                    </div>
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fas fa-bug"></i></div>
                        <h3>Bug Reports</h3>
                        <p>Help improve stability and reliability</p>
                        <a href="https://t.me/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">Telegram</a>
                    </div>
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fas fa-book"></i></div>
                        <h3>Documentation</h3>
                        <p>Improve this wiki and make ShaniOS more accessible</p>
                        <a href="https://github.com/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">Contribute</a>
                    </div>
                </div>
                
                <h3>Resources</h3>
                <ul>
                    <li><strong>Website:</strong> <a href="https://shani.dev" target="_blank">shani.dev</a></li>
                    <li><strong>GitHub:</strong> <a href="https://github.com/shani8dev" target="_blank">github.com/shani8dev</a></li>
                    <li><strong>Telegram:</strong> <a href="https://t.me/shani8dev" target="_blank">t.me/shani8dev</a></li>
                </ul>
            </section>
            
            <!-- FOOTER -->
            <footer class="wiki-footer">
                <div class="footer-content">
                    <div class="footer-logo">
                        <img src="assets/images/about.svg" alt="ShaniOS" width="100" height="40" />
                        <p>Immutable. Reliable. Secure.</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; <span id="copyright-year"></span> ShaniOS Project. Open Source & Immutable.</p>
                    <div class="footer-social">
                        <a href="https://github.com/shani8dev" aria-label="GitHub" target="_blank"><i class="fab fa-github"></i></a>
                        <a href="https://t.me/shani8dev" aria-label="Telegram" target="_blank"><i class="fab fa-telegram"></i></a>
                     </div>
                </div>
            </footer>
        </main>
    </div>

  <!-- Back to Top -->
  <a href="#overview" class="back-to-top" aria-label="Back to top">
    <i class="fas fa-chevron-up"></i>
  </a>

  <!-- Scripts -->
  <script src="assets/js/script.js"></script>
  <script>
    document.getElementById('copyright-year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
