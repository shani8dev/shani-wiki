<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ShaniOS Technical Documentation - Comprehensive guide to the immutable Linux OS with atomic updates, blue-green deployment, and Btrfs filesystem.">
    <meta name="keywords" content="ShaniOS, immutable OS, Linux, Btrfs, atomic updates, blue-green deployment, Arch Linux">
    <meta name="author" content="ShaniOS Project">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="ShaniOS Wiki - Technical Documentation">
    <meta property="og:description" content="Comprehensive technical documentation for ShaniOS - The immutable Linux OS with atomic updates">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://shani.dev">
    <meta property="og:image" content="assets/images/logo.svg">
    
    <!-- Favicons & Manifest -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="assets/images/site.webmanifest">
    <meta name="theme-color" content="#1a102f">

    <title>ShaniOS Wiki - Technical Documentation</title>
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" defer></script>
</head>
<body>
    <div class="wiki-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
                <h2>ShaniOS Wiki</h2>
                <p class="subtitle">Technical Documentation</p>
            </div>
            
            <div class="search-box" role="search">
                <input 
                    type="text" 
                    placeholder="Search documentation..." 
                    aria-label="Search documentation"
                    autocomplete="off">
                <button aria-label="Search"><i class="fas fa-search"></i></button>
            </div>
            
            <ul class="nav-links">
                <li><a href="#overview"><i class="fas fa-home"></i> Overview</a></li>
                <li>
                    <a href="#installation" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-download"></i> Installation
                    </a>
                    <ul class="submenu">
                        <li><a href="#requirements">Requirements</a></li>
                        <li><a href="#pre-installation">Pre-Installation</a></li>
                        <li><a href="#installation-steps">Installation Steps</a></li>
                        <li><a href="#first-boot">First Boot</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#daily-use" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-desktop"></i> Daily Use
                    </a>
                    <ul class="submenu">
                        <li><a href="#system-updates">System Updates</a></li>
                        <li><a href="#software-management">Software Management</a></li>
                        <li><a href="#common-tasks">Common Tasks</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#architecture" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-layer-group"></i> Architecture
                    </a>
                    <ul class="submenu">
                        <li><a href="#blue-green">Blue-Green Deployment</a></li>
                        <li><a href="#filesystem">Filesystem Structure</a></li>
                        <li><a href="#boot-process">Boot Process</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#advanced" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-cogs"></i> Advanced
                    </a>
                    <ul class="submenu">
                        <li><a href="#btrfs-deep-dive">Btrfs Deep Dive</a></li>
                        <li><a href="#overlay-fs">Overlay Filesystem</a></li>
                        <li><a href="#persistent-storage">Persistent Storage</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#security" class="dropdown-link" role="button" aria-expanded="false">
                        <i class="fas fa-shield-alt"></i> Security
                    </a>
                    <ul class="submenu">
                        <li><a href="#security-overview">Security Overview</a></li>
                        <li><a href="#secure-boot">Secure Boot Setup</a></li>
                        <li><a href="#tpm-encryption">TPM Encryption</a></li>
                    </ul>
                </li>
                <li><a href="#troubleshooting"><i class="fas fa-wrench"></i> Troubleshooting</a></li>
                <li><a href="#faq"><i class="fas fa-question-circle"></i> FAQ</a></li>
                <li><a href="#contribute"><i class="fas fa-code-branch"></i> Contribute</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Header -->
            <header class="header">
                <div class="logo">
                    <img src="assets/images/logo.svg" alt="ShaniOS Logo" width="150" height="150">
                </div>
                <div class="header-text">
                    <h1>ShaniOS Technical Documentation</h1>
                    <p>Comprehensive guide to ShaniOS - The immutable Linux OS with atomic updates</p>
                </div>
            </header>

            <!-- OVERVIEW -->
            <section id="overview" class="wiki-section">
                <h2>Overview</h2>
                <p>Welcome to the ShaniOS technical documentation. This wiki provides in-depth information about ShaniOS's architecture, installation, configuration, and daily use.</p>
                
                <div class="note-box" role="note">
                    <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                    <div class="note-content">
                        <p><strong>New to ShaniOS?</strong> Visit <a href="https://shani.dev" target="_blank" rel="noopener noreferrer">shani.dev</a> for an introduction to ShaniOS features and philosophy. This wiki focuses on technical implementation details.</p>
                    </div>
                </div>

                <h3>What Makes ShaniOS Different</h3>
                <p>ShaniOS is an immutable operating system that adapts enterprise DevOps practices for desktop Linux:</p>
                <ul>
                    <li><strong>Blue-Green Deployment:</strong> Two complete system images ensure zero-downtime updates</li>
                    <li><strong>Atomic Updates:</strong> Updates either succeed completely or fail safely</li>
                    <li><strong>Instant Recovery:</strong> Automatic rollback on boot failure</li>
                    <li><strong>Read-Only Root:</strong> System integrity protected at the filesystem level</li>
                    <li><strong>Selective Persistence:</strong> User data and configurations persist across updates</li>
                    <li><strong>Intelligent Update System:</strong> Mirror discovery, resume support, and automatic verification</li>
                </ul>

                <h3>Documentation Structure</h3>
                <div class="card-container">
                    <article class="card">
                        <div class="card-icon"><i class="fas fa-download"></i></div>
                        <h4>Installation</h4>
                        <p>System requirements, BIOS setup, and step-by-step installation guide</p>
                    </article>
                    <article class="card">
                        <div class="card-icon"><i class="fas fa-user"></i></div>
                        <h4>Daily Use</h4>
                        <p>Updates, software management, gaming, containers, and common tasks</p>
                    </article>
                    <article class="card">
                        <div class="card-icon"><i class="fas fa-project-diagram"></i></div>
                        <h4>Architecture</h4>
                        <p>Technical details of blue-green deployment and filesystem structure</p>
                    </article>
                    <article class="card">
                        <div class="card-icon"><i class="fas fa-shield-alt"></i></div>
                        <h4>Security</h4>
                        <p>Secure Boot, TPM encryption, and security hardening</p>
                    </article>
                </div>
            </section>

            <!-- INSTALLATION -->
            <section id="installation" class="wiki-section">
                <h2>Installation</h2>
                
                <div id="requirements">
                    <h3>System Requirements</h3>
                    <div class="table-wrapper">
                        <table>
                            <caption class="sr-only">ShaniOS System Requirements</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Component</th>
                                    <th scope="col">Minimum</th>
                                    <th scope="col">Recommended</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">Processor</th>
                                    <td>x86_64 dual-core with VT-x/AMD-V</td>
                                    <td>x86_64 quad-core or better</td>
                                </tr>
                                <tr>
                                    <th scope="row">Memory</th>
                                    <td>4 GB RAM</td>
                                    <td>8 GB RAM or more</td>
                                </tr>
                                <tr>
                                    <th scope="row">Storage</th>
                                    <td>32 GB (dual-image architecture)</td>
                                    <td>64 GB or more</td>
                                </tr>
                                <tr>
                                    <th scope="row">Firmware</th>
                                    <td>UEFI (required)</td>
                                    <td>UEFI with TPM 2.0</td>
                                </tr>
                                <tr>
                                    <th scope="row">Installation Media</th>
                                    <td>8 GB USB drive</td>
                                    <td>16 GB USB 3.0 drive</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Why 32GB minimum?</strong> ShaniOS maintains two complete system images (@blue and @green) for atomic updates. However, Btrfs Copy-on-Write shares unchanged data between them, resulting in only ~18% overhead compared to traditional systems.</p>
                        </div>
                    </div>

                    <h3>What's Included</h3>
                    <p>ShaniOS comes pre-configured with everything you need:</p>
                    <ul>
                        <li><strong>Base:</strong> Arch Linux foundation, Btrfs filesystem, systemd-boot</li>
                        <li><strong>Desktop:</strong> GNOME or KDE Plasma (chosen at download)</li>
                        <li><strong>Applications:</strong> Vivaldi Browser, OnlyOffice, Gear Lever</li>
                        <li><strong>Containers:</strong> Podman, Distrobox, LXC, systemd-nspawn, Pods GUI</li>
                        <li><strong>Android:</strong> Waydroid pre-installed and configured</li>
                        <li><strong>Drivers:</strong> Intel/AMD/NVIDIA graphics, CUPS printing, SANE scanning</li>
                        <li><strong>Fonts:</strong> Complete multilingual support including Indian languages and CJK</li>
                        <li><strong>Security:</strong> AppArmor, firewalld, LUKS2 encryption (optional)</li>
                    </ul>
                </div>
                
                <div id="pre-installation">
                    <h3>Pre-Installation: BIOS/UEFI Configuration</h3>
                    <p>Configure your firmware before installation (typically accessed via F2, F10, Del, or Esc during startup):</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Disable Fast Boot</h4>
                                <p>Fast Boot can interfere with USB boot and Linux installation</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Disable Secure Boot (Temporarily)</h4>
                                <p>Required for installation. Can be re-enabled after enrolling ShaniOS MOK keys</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Set SATA Mode to AHCI</h4>
                                <p>Ensures optimal disk performance and compatibility</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Enable UEFI Boot</h4>
                                <p>Disable legacy/CSM mode. ShaniOS requires UEFI</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Enable Virtualization</h4>
                                <p>Enable Intel VT-x or AMD-V for container support</p>
                            </div>
                        </article>
                    </div>

                    <h3>Creating Installation Media</h3>
                    <p>Download the ShaniOS ISO from <a href="https://shani.dev" target="_blank" rel="noopener noreferrer">shani.dev</a> and write it to USB:</p>
                    <ul>
                        <li><strong>Recommended:</strong> Balena Etcher (cross-platform, user-friendly)</li>
                        <li><strong>Windows:</strong> Rufus (advanced options available)</li>
                        <li><strong>Linux/Mac:</strong> dd command or GNOME Disks</li>
                    </ul>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>Do Not Use Ventoy:</strong> Ventoy has known compatibility issues with ShaniOS's immutable architecture and will cause installation failures.</p>
                        </div>
                    </div>
                </div>

                <div id="installation-steps">
                    <h3>Installation Process</h3>
                    <p>Installation takes approximately 10-15 minutes:</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Boot from USB</h4>
                                <p>Press F12, F2, or Del during startup. Select your USB drive from the boot menu.</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Select "Install ShaniOS"</h4>
                                <p>Choose the installation option from the boot menu</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Language & Region</h4>
                                <p>Select language, timezone, and keyboard layout</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Disk Selection</h4>
                                <p>Choose target disk and partitioning scheme (automatic recommended)</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Encryption (Optional)</h4>
                                <p>Enable LUKS2 full-disk encryption. Recommended for laptops and portable systems.</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>Install</h4>
                                <p>The installer creates Btrfs subvolumes, installs the base system, and configures the bootloader</p>
                            </div>
                        </article>
                        <article class="step">
                            <div class="step-number">7</div>
                            <div class="step-content">
                                <h4>Reboot</h4>
                                <p>Remove USB drive when prompted and reboot into ShaniOS</p>
                            </div>
                        </article>
                    </div>
                </div>

                <div id="first-boot">
                    <h3>First Boot Setup</h3>
                    <p>On first boot, the Initial Setup wizard guides you through:</p>
                    <ul>
                        <li>Creating your user account</li>
                        <li>Configuring network connections</li>
                        <li>Setting privacy preferences</li>
                        <li>Enabling location services (optional)</li>
                        <li>Customizing appearance settings</li>
                    </ul>
                    <p>This approach keeps installation fast while personalizing the system on first use.</p>
                </div>
            </section>

            <!-- DAILY USE -->
            <section id="daily-use" class="wiki-section">
                <h2>Daily Use</h2>
                
                <div id="system-updates">
                    <h3>System Updates</h3>
                    <p>ShaniOS uses an intelligent multi-layered update system with automatic checking, user notifications, and the <code>shani-deploy</code> tool for atomic system updates.</p>
                    
                    <h4>Automatic Update Checker</h4>
                    <p>ShaniOS includes a background service that automatically checks for updates:</p>
                    <ul>
                        <li><strong>shani-update:</strong> Runs periodically via systemd user timer</li>
                        <li>Checks SourceForge for new releases matching your system profile</li>
                        <li>Notifies you when updates are available</li>
                        <li>Provides user-friendly GUI dialogs for update approval</li>
                        <li>Automatically launches terminal-based update installer</li>
                    </ul>

                    <h4>Manual Update</h4>
                    <div class="code-block">
                        <pre><code>sudo shani-deploy</code></pre>
                    </div>
                    
                    <p>The update process includes sophisticated features:</p>
                    <ol>
                        <li><strong>Prerequisites Check:</strong> Verifies root access, internet connectivity, available disk space</li>
                        <li><strong>Power Management:</strong> Prevents system sleep/shutdown during update using systemd-inhibit</li>
                        <li><strong>Boot Validation:</strong> Validates current boot state (@blue or @green)</li>
                        <li><strong>Mirror Discovery:</strong> Automatically finds fastest SourceForge mirror</li>
                        <li><strong>Intelligent Download:</strong> 
                            <ul>
                                <li>Supports resume from partial downloads</li>
                                <li>Tries multiple download tools (aria2c, wget, curl)</li>
                                <li>Validates file integrity during download</li>
                                <li>Detects and handles preallocated files</li>
                            </ul>
                        </li>
                        <li><strong>Verification:</strong> SHA256 checksum and GPG signature validation</li>
                        <li><strong>Deployment:</strong> Extracts update to inactive subvolume with progress tracking</li>
                        <li><strong>UKI Generation:</strong> Creates new Unified Kernel Images for both slots</li>
                        <li><strong>Bootloader Update:</strong> Updates systemd-boot configuration</li>
                        <li><strong>Configuration Migration:</strong> Preserves persistent configurations</li>
                        <li><strong>Integrity Validation:</strong> Verifies deployment success</li>
                        <li><strong>Storage Optimization:</strong> Runs deduplication and cleanup</li>
                    </ol>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Automatic Rollback:</strong> If the updated system fails to boot, ShaniOS automatically reverts to the previous working state on next startup. The boot-success marker system tracks successful boots, and automatic fallback ensures system reliability.</p>
                        </div>
                    </div>

                    <h4>Update Channels</h4>
                    <p>ShaniOS supports multiple update channels:</p>
                    <ul>
                        <li><strong>stable (default):</strong> Thoroughly tested releases</li>
                        <li><strong>latest:</strong> Newest features (may be less stable)</li>
                    </ul>
                    <p>Set your preferred channel:</p>
                    <div class="code-block">
                        <pre><code># Choose channel
sudo shani-deploy -t latest

# Or set permanently
echo "latest" | sudo tee /etc/shani-channel</code></pre>
                    </div>

                    <h4>Update Options</h4>
                    <div class="code-block">
                        <pre><code># Show help
sudo shani-deploy --help

# Force rollback to previous version
sudo shani-deploy --rollback

# Manual cleanup of old backups and downloads
sudo shani-deploy --cleanup

# Storage analysis with deduplication
sudo shani-deploy --storage-info

# Dry run (simulate without changes)
sudo shani-deploy --dry-run

# Verbose output for troubleshooting
sudo shani-deploy --verbose</code></pre>
                    </div>

                    <h4>Application Updates</h4>
                    <p>Update Flatpak applications:</p>
                    <div class="code-block">
                        <pre><code>flatpak update</code></pre>
                    </div>

                    <h4>Firmware Updates</h4>
                    <p>Update device firmware via LVFS:</p>
                    <div class="code-block">
                        <pre><code>fwupdmgr refresh
fwupdmgr update</code></pre>
                    </div>
                </div>
                
                <div id="software-management">
                    <h3>Software Management</h3>
                    <p>ShaniOS uses Flatpak for application management to maintain system immutability.</p>
                    
                    <h4>Installing Applications</h4>
                    <div class="code-block">
                        <pre><code># Install from Flathub
flatpak install flathub org.application.Name

# Search for applications
flatpak search keyword</code></pre>
                    </div>
                    
                    <h4>Managing Applications</h4>
                    <p>Use command line or graphical tools:</p>
                    <ul>
                        <li><strong>GNOME:</strong> Software (GNOME Software)</li>
                        <li><strong>KDE:</strong> Discover</li>
                        <li><strong>CLI:</strong> flatpak command</li>
                    </ul>
                    
                    <h4>Persistent Configuration Changes</h4>
                    <p>The <code>/etc</code> directory uses overlay filesystem, allowing modifications:</p>
                    <div class="code-block">
                        <pre><code># Edit system configuration
sudo nano /etc/some-config-file

# Changes are stored in /data/overlay/etc/upper
# and persist across system updates</code></pre>
                    </div>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>No pacman:</strong> Traditional package management via pacman is not supported. The base system is immutable. Use Flatpak, containers, or AppImages for applications.</p>
                        </div>
                    </div>
                </div>

                <div id="common-tasks">
                    <h3>Common Tasks</h3>
                    
                    <h4>Gaming</h4>
                    <p><strong>Game Launchers:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub com.valvesoftware.Steam
flatpak install flathub com.heroicgameslauncher.hgl
flatpak install flathub net.lutris.Lutris
flatpak install flathub org.libretro.RetroArch</code></pre>
                    </div>
                    
                    <p><strong>Gaming Peripherals:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub io.github.antimicrox.antimicrox  # Gamepad mapper
flatpak install flathub org.freedesktop.Piper            # Mouse configuration
flatpak install flathub org.openrgb.OpenRGB              # RGB lighting</code></pre>
                    </div>
                    
                    <p><strong>Performance Tools:</strong></p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub io.github.benjamimgois.goverlay  # Overlay manager
flatpak install flathub org.freedesktop.Platform.VulkanLayer.MangoHud
flatpak install flathub org.freedesktop.Platform.VulkanLayer.gamescope</code></pre>
                    </div>

                    <h4>Windows Applications</h4>
                    <p>Run Windows apps using Wine via Bottles:</p>
                    <div class="code-block">
                        <pre><code>flatpak install flathub com.usebottles.bottles</code></pre>
                    </div>

                    <h4>Containers & Development</h4>
                    <p><strong>Podman (Docker-compatible):</strong></p>
                    <div class="code-block">
                        <pre><code># Run container
podman run -it --rm ubuntu:22.04 bash

# Docker Compose style
podman compose up -d</code></pre>
                    </div>
                    
                    <p><strong>Distrobox (Development environments):</strong></p>
                    <div class="code-block">
                        <pre><code># Create Ubuntu environment
distrobox create --name ubuntu --image ubuntu:22.04

# Enter environment
distrobox enter ubuntu</code></pre>
                    </div>
                    
                    <p><strong>LXC System Containers:</strong></p>
                    <div class="code-block">
                        <pre><code>lxc launch images:ubuntu/22.04 my-container</code></pre>
                    </div>

                    <h4>Android Applications</h4>
                    <p>Waydroid is pre-installed. Launch from Applications menu and complete setup wizard.</p>

                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Important Notes:</strong></p>
                            <ul>
                                <li>Dual booting not recommended (other OSes may break bootloader)</li>
                                <li>Use Flatpak, containers, or AppImages for software</li>
                                <li>Root filesystem is immutable by design</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ARCHITECTURE -->
            <section id="architecture" class="wiki-section">
                <h2>Architecture</h2>
                
                <div id="blue-green">
                    <h3>Blue-Green Deployment</h3>
                    <p>ShaniOS implements blue-green deployment using Btrfs subvolumesâ€”a strategy adapted from DevOps for desktop Linux.</p>
                    
                    <div class="blue-green-diagram">
                        <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <!-- Background -->
                            <rect width="800" height="400" fill="#0b0618"/>
                            
                            <!-- Blue System -->
                            <g>
                                <rect x="50" y="80" width="300" height="240" rx="12" fill="#1e3a8a" opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
                                <text x="200" y="110" text-anchor="middle" fill="#60a5fa" font-size="20" font-weight="bold">@blue (Active)</text>
                                <text x="200" y="140" text-anchor="middle" fill="#93c5fd" font-size="14">Currently Running</text>
                                <circle cx="200" cy="200" r="40" fill="#3b82f6" opacity="0.5"/>
                                <text x="200" y="210" text-anchor="middle" fill="#fff" font-size="16">System</text>
                                <text x="200" y="280" text-anchor="middle" fill="#93c5fd" font-size="12">Mounted as /</text>
                            </g>
                            
                            <!-- Green System -->
                            <g>
                                <rect x="450" y="80" width="300" height="240" rx="12" fill="#166534" opacity="0.3" stroke="#22c55e" stroke-width="2"/>
                                <text x="600" y="110" text-anchor="middle" fill="#4ade80" font-size="20" font-weight="bold">@green (Inactive)</text>
                                <text x="600" y="140" text-anchor="middle" fill="#86efac" font-size="14">Ready for Update</text>
                                <circle cx="600" cy="200" r="40" fill="#22c55e" opacity="0.5"/>
                                <text x="600" y="210" text-anchor="middle" fill="#fff" font-size="16">System</text>
                                <text x="600" y="280" text-anchor="middle" fill="#86efac" font-size="12">Standby Mode</text>
                            </g>
                            
                            <!-- Arrow -->
                            <g>
                                <line x1="350" y1="200" x2="430" y2="200" stroke="#ff8a5c" stroke-width="3" marker-end="url(#arrowhead)"/>
                                <text x="390" y="190" text-anchor="middle" fill="#ff8a5c" font-size="14">Update Flow</text>
                            </g>
                            
                            <!-- Arrow marker -->
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Blue-Green Deployment: Two complete system images with only one active at a time</p>
                    </div>
                    
                    <h4>How It Works</h4>
                    <ol>
                        <li><strong>Dual Root Subvolumes:</strong> System maintains @blue and @green subvolumes</li>
                        <li><strong>Active/Inactive States:</strong> One subvolume is active (mounted as /), the other inactive</li>
                        <li><strong>Update Flow:</strong>
                            <ul>
                                <li>Boot from active subvolume (e.g., @blue)</li>
                                <li>Update applies to inactive subvolume (@green)</li>
                                <li>Bootloader updated to point to @green</li>
                                <li>Reboot into updated @green</li>
                                <li>@blue becomes inactive (available for rollback)</li>
                            </ul>
                        </li>
                    </ol>
                    
                    <h4>Advantages</h4>
                    <ul>
                        <li><strong>Atomic Updates:</strong> Updates either succeed completely or fail safely</li>
                        <li><strong>Zero Downtime:</strong> Active system never modified</li>
                        <li><strong>Instant Rollback:</strong> Select previous image from boot menu</li>
                        <li><strong>Testing:</strong> Validate updates before committing</li>
                    </ul>
                </div>
                
                <div id="filesystem">
                    <h3>Filesystem Structure</h3>
                    <p>ShaniOS uses Btrfs with a sophisticated subvolume layout:</p>
                    
                    <div class="architecture-diagram">
                        <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <!-- Background -->
                            <rect width="800" height="500" fill="#0b0618"/>
                            
                            <!-- Title -->
                            <text x="400" y="30" text-anchor="middle" fill="#ff8a5c" font-size="22" font-weight="bold">Btrfs Subvolume Structure</text>
                            
                            <!-- Root Device -->
                            <rect x="300" y="60" width="200" height="40" rx="8" fill="#8b5cf6" opacity="0.4" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="400" y="85" text-anchor="middle" fill="#fff" font-size="14">/dev/sda2 (Btrfs)</text>
                            
                            <!-- System Layer -->
                            <g>
                                <rect x="50" y="130" width="280" height="160" rx="8" fill="#1e3a8a" opacity="0.2" stroke="#3b82f6" stroke-width="1.5"/>
                                <text x="190" y="155" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">System Images</text>
                                
                                <rect x="70" y="170" width="100" height="35" rx="6" fill="#3b82f6" opacity="0.5"/>
                                <text x="120" y="192" text-anchor="middle" fill="#fff" font-size="12">@blue</text>
                                
                                <rect x="210" y="170" width="100" height="35" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="260" y="192" text-anchor="middle" fill="#fff" font-size="12">@green</text>
                                
                                <text x="190" y="230" text-anchor="middle" fill="#93c5fd" font-size="11">Root filesystems</text>
                                <text x="190" y="250" text-anchor="middle" fill="#93c5fd" font-size="11">Read-only</text>
                            </g>
                            
                            <!-- User Data Layer -->
                            <g>
                                <rect x="370" y="130" width="180" height="160" rx="8" fill="#166534" opacity="0.2" stroke="#22c55e" stroke-width="1.5"/>
                                <text x="460" y="155" text-anchor="middle" fill="#4ade80" font-size="16" font-weight="bold">User Data</text>
                                
                                <rect x="390" y="170" width="140" height="30" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="460" y="190" text-anchor="middle" fill="#fff" font-size="12">@home</text>
                                
                                <rect x="390" y="210" width="140" height="30" rx="6" fill="#22c55e" opacity="0.5"/>
                                <text x="460" y="230" text-anchor="middle" fill="#fff" font-size="12">@data</text>
                                
                                <text x="460" y="260" text-anchor="middle" fill="#86efac" font-size="11">Persistent</text>
                            </g>
                            
                            <!-- Services Layer -->
                            <g>
                                <rect x="590" y="130" width="180" height="160" rx="8" fill="#7c2d12" opacity="0.2" stroke="#f97316" stroke-width="1.5"/>
                                <text x="680" y="155" text-anchor="middle" fill="#fb923c" font-size="16" font-weight="bold">Services</text>
                                
                                <rect x="610" y="170" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="186" text-anchor="middle" fill="#fff" font-size="11">@flatpak</text>
                                
                                <rect x="610" y="200" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="216" text-anchor="middle" fill="#fff" font-size="11">@containers</text>
                                
                                <rect x="610" y="230" width="140" height="24" rx="6" fill="#f97316" opacity="0.5"/>
                                <text x="680" y="246" text-anchor="middle" fill="#fff" font-size="11">@waydroid</text>
                                
                                <text x="680" y="270" text-anchor="middle" fill="#fdba74" font-size="11">Isolated storage</text>
                            </g>
                            
                            <!-- System Volumes -->
                            <g>
                                <rect x="50" y="320" width="700" height="150" rx="8" fill="#581c87" opacity="0.2" stroke="#a855f7" stroke-width="1.5"/>
                                <text x="400" y="345" text-anchor="middle" fill="#c084fc" font-size="16" font-weight="bold">Additional Subvolumes</text>
                                
                                <rect x="70" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="125" y="378" text-anchor="middle" fill="#fff" font-size="11">@log</text>
                                
                                <rect x="200" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="255" y="378" text-anchor="middle" fill="#fff" font-size="11">@cache</text>
                                
                                <rect x="330" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="385" y="378" text-anchor="middle" fill="#fff" font-size="11">@machines</text>
                                
                                <rect x="460" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="515" y="378" text-anchor="middle" fill="#fff" font-size="11">@lxc</text>
                                
                                <rect x="590" y="360" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="645" y="378" text-anchor="middle" fill="#fff" font-size="11">@libvirt</text>
                                
                                <rect x="170" y="405" width="110" height="28" rx="6" fill="#a855f7" opacity="0.4"/>
                                <text x="225" y="423" text-anchor="middle" fill="#fff" font-size="11">@swap</text>
                                
                                <text x="225" y="448" text-anchor="middle" fill="#e9d5ff" font-size="10">(nodatacow)</text>
                            </g>
                        </svg>
                        <p class="caption">Btrfs subvolume organization showing system, user, and persistence layers</p>
                    </div>
                    
                    <div class="table-wrapper">
                        <table>
                            <caption class="sr-only">ShaniOS Subvolume Layout</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Subvolume</th>
                                    <th scope="col">Mount Point</th>
                                    <th scope="col">Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">@blue / @green</th>
                                    <td>/</td>
                                    <td>Root filesystems for blue-green deployment</td>
                                </tr>
                                <tr>
                                    <th scope="row">@home</th>
                                    <td>/home</td>
                                    <td>User data and personal configurations</td>
                                </tr>
                                <tr>
                                    <th scope="row">@data</th>
                                    <td>/data</td>
                                    <td>Overlay storage and persistent service data</td>
                                </tr>
                                <tr>
                                    <th scope="row">@log</th>
                                    <td>/var/log</td>
                                    <td>System logs across reboots</td>
                                </tr>
                                <tr>
                                    <th scope="row">@cache</th>
                                    <td>/var/cache</td>
                                    <td>Package manager cache</td>
                                </tr>
                                <tr>
                                    <th scope="row">@flatpak</th>
                                    <td>/var/lib/flatpak</td>
                                    <td>Flatpak applications and runtimes</td>
                                </tr>
                                <tr>
                                    <th scope="row">@waydroid</th>
                                    <td>/var/lib/waydroid</td>
                                    <td>Android system images and data</td>
                                </tr>
                                <tr>
                                    <th scope="row">@containers</th>
                                    <td>/var/lib/containers</td>
                                    <td>Podman/Docker container storage</td>
                                </tr>
                                <tr>
                                    <th scope="row">@machines</th>
                                    <td>/var/lib/machines</td>
                                    <td>systemd-nspawn containers</td>
                                </tr>
                                <tr>
                                    <th scope="row">@lxc</th>
                                    <td>/var/lib/lxc</td>
                                    <td>LXC containers</td>
                                </tr>
                                <tr>
                                    <th scope="row">@libvirt</th>
                                    <td>/var/lib/libvirt</td>
                                    <td>Virtual machine disk images (nodatacow)</td>
                                </tr>
                                <tr>
                                    <th scope="row">@swap</th>
                                    <td>/swap</td>
                                    <td>Swap file container (nodatacow)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="boot-process">
                    <h3>Boot Process</h3>
                    <p>Understanding ShaniOS boot sequence:</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>UEFI Firmware</h4>
                                <p>Loads systemd-boot from ESP (/boot/efi)</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>systemd-boot</h4>
                                <p>Presents boot menu with @blue and @green entries</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Kernel Loading</h4>
                                <p>Boots selected Unified Kernel Image (UKI)</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Initramfs</h4>
                                <p>Unlocks LUKS partition (if encrypted), mounts selected root subvolume</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>systemd Init</h4>
                                <p>Starts with <code>systemd.volatile=state</code> kernel parameter</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>Filesystem Setup</h4>
                                <ul>
                                    <li>Root mounted read-only</li>
                                    <li>/var created as tmpfs (volatile)</li>
                                    <li>/etc overlay mounted (writable layer over read-only base)</li>
                                    <li>Persistent subvolumes mounted (@home, @data, @log, etc.)</li>
                                    <li>Service state bind-mounted from @data</li>
                                </ul>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">7</div>
                            <div class="step-content">
                                <h4>System Start</h4>
                                <p>Services launch, desktop environment loads</p>
                            </div>
                        </article>
                    </div>
                </div>
            </section>

            <!-- ADVANCED -->
            <section id="advanced" class="wiki-section">
                <h2>Advanced Topics</h2>
                
                <div id="btrfs-deep-dive">
                    <h3>Btrfs Deep Dive</h3>
                    <p>ShaniOS leverages advanced Btrfs features for immutability and efficiency:</p>
                    
                    <h4>Copy-on-Write (CoW)</h4>
                    <p>Btrfs CoW minimizes storage duplication between @blue and @green:</p>
                    <ul>
                        <li>Shared data blocks between subvolumes reduce overhead to ~18%</li>
                        <li>Only modified blocks consume additional space</li>
                        <li>Updates efficient even with dual root system</li>
                    </ul>
                    
                    <h4>Compression</h4>
                    <p>Transparent zstd compression enabled by default:</p>
                    <div class="code-block">
                        <pre><code># Mount options in fstab
            compress=zstd,space_cache=v2,autodefrag</code></pre>
                    </div>
                    <ul>
                        <li>Reduces disk usage by 30-50% depending on data</li>
                        <li>Minimal CPU overhead with hardware acceleration</li>
                        <li>Improves SSD lifespan by reducing writes</li>
                    </ul>
                    
                    <h4>Performance Optimizations</h4>
                    <p>Specific subvolumes use <code>nodatacow</code> for performance:</p>
                    <ul>
                        <li><strong>@swap:</strong> CoW disabled for swap files (required)</li>
                        <li><strong>@libvirt:</strong> VM disk images benefit from direct writes</li>
                    </ul>
                    
                    <div class="code-block">
                        <pre><code># Example fstab entry for VM storage
            LABEL=shani_root /var/lib/libvirt btrfs \
              nofail,noatime,subvol=@libvirt,rw,nodatacow,nospace_cache 0 0</code></pre>
                    </div>
                </div>
                
                <div id="overlay-fs">
                    <h3>Overlay Filesystem</h3>
                    <p>OverlayFS enables writable /etc on read-only root:</p>
                    
                    <div class="overlay-diagram">
                        <svg viewBox="0 0 700 400" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto;">
                            <!-- Background -->
                            <rect width="700" height="400" fill="#0b0618"/>
                            
                            <!-- Title -->
                            <text x="350" y="30" text-anchor="middle" fill="#ff8a5c" font-size="20" font-weight="bold">Overlay Filesystem Structure</text>
                            
                            <!-- Lower Layer (Read-only) -->
                            <g>
                                <rect x="50" y="80" width="250" height="120" rx="8" fill="#7c2d12" opacity="0.3" stroke="#f97316" stroke-width="2"/>
                                <text x="175" y="105" text-anchor="middle" fill="#fb923c" font-size="16" font-weight="bold">Lower Layer</text>
                                <text x="175" y="130" text-anchor="middle" fill="#fdba74" font-size="13">/etc (Read-only)</text>
                                <text x="175" y="155" text-anchor="middle" fill="#fdba74" font-size="12">From @blue/@green</text>
                                <circle cx="175" cy="180" r="8" fill="#f97316"/>
                                <text x="175" y="185" text-anchor="middle" fill="#fff" font-size="10">ðŸ”’</text>
                            </g>
                            
                            <!-- Upper Layer (Writable) -->
                            <g>
                                <rect x="400" y="80" width="250" height="120" rx="8" fill="#166534" opacity="0.3" stroke="#22c55e" stroke-width="2"/>
                                <text x="525" y="105" text-anchor="middle" fill="#4ade80" font-size="16" font-weight="bold">Upper Layer</text>
                                <text x="525" y="130" text-anchor="middle" fill="#86efac" font-size="13">/data/overlay/etc/upper</text>
                                <text x="525" y="155" text-anchor="middle" fill="#86efac" font-size="12">Changes stored here</text>
                                <circle cx="525" cy="180" r="8" fill="#22c55e"/>
                                <text x="525" y="185" text-anchor="middle" fill="#fff" font-size="10">âœï¸</text>
                            </g>
                            
                            <!-- Merged View -->
                            <g>
                                <rect x="200" y="250" width="300" height="120" rx="8" fill="#1e3a8a" opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
                                <text x="350" y="275" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">Merged View</text>
                                <text x="350" y="300" text-anchor="middle" fill="#93c5fd" font-size="13">/etc (User sees this)</text>
                                <text x="350" y="325" text-anchor="middle" fill="#93c5fd" font-size="12">Appears writable</text>
                                <text x="350" y="345" text-anchor="middle" fill="#93c5fd" font-size="12">Changes persist across updates</text>
                            </g>
                            
                            <!-- Arrows -->
                            <g>
                                <line x1="175" y1="210" x2="280" y2="250" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow1)"/>
                                <line x1="525" y1="210" x2="420" y2="250" stroke="#ff8a5c" stroke-width="2" marker-end="url(#arrow1)"/>
                            </g>
                            
                            <defs>
                                <marker id="arrow1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#ff8a5c"/>
                                </marker>
                            </defs>
                        </svg>
                        <p class="caption">Overlay filesystem structure: read-only lower layer with writable upper layer</p>
                    </div>
                    
                    <h4>How Overlay Works</h4>
                    <div class="code-block">
                        <pre><code># /etc overlay mount from fstab
            overlay /etc overlay \
              rw,lowerdir=/etc,\
              upperdir=/data/overlay/etc/upper,\
              workdir=/data/overlay/etc/work,\
              index=off,metacopy=off 0 0</code></pre>
                    </div>
                    
                    <ul>
                        <li><strong>lowerdir:</strong> Read-only /etc from @blue or @green</li>
                        <li><strong>upperdir:</strong> Writable layer in @data (stores all changes)</li>
                        <li><strong>workdir:</strong> Temporary space for atomic operations</li>
                    </ul>
                    
                    <h4>Benefits</h4>
                    <ul>
                        <li>System configuration appears writable to applications</li>
                        <li>Changes persist across updates and blue-green switches</li>
                        <li>Original system files remain untouched</li>
                        <li>Easy to review or reset configuration changes</li>
                    </ul>
                    
                    <h4>Viewing Changes</h4>
                    <div class="code-block">
                        <pre><code># List all overlay modifications
            ls -la /data/overlay/etc/upper

            # Compare with base system
            diff -r /etc /data/overlay/etc/upper</code></pre>
                    </div>
                </div>
                
                <div id="persistent-storage">
                    <h3>Persistent Storage Strategy</h3>
                    <p>ShaniOS selectively persists data across immutable system updates:</p>
                    
                    <h4>Bind-Mounted Service State</h4>
                    <p>System services require persistent state stored in @data subvolume:</p>
                    
                    <div class="code-block">
                        <pre><code># Example bind mounts from fstab

            # Network configuration
            /data/varlib/NetworkManager /var/lib/NetworkManager \
              none bind,nofail 0 0

            # Bluetooth pairings
            /data/varlib/bluetooth /var/lib/bluetooth \
              none bind,nofail 0 0

            # systemd state (timers, random seed)
            /data/varlib/systemd /var/lib/systemd \
              none bind,nofail 0 0</code></pre>
                    </div>
                    
                    <h4>Complete Persistent Bindings</h4>
                    <p>The following service data persists across updates:</p>
                    <ul>
                        <li><strong>Core:</strong> dbus, systemd, NetworkManager</li>
                        <li><strong>Authentication:</strong> AccountsService, fprint, bluetooth, boltd</li>
                        <li><strong>Display:</strong> gdm, sddm</li>
                        <li><strong>Hardware:</strong> colord, upower, cups, sane</li>
                        <li><strong>Security:</strong> firewalld</li>
                        <li><strong>Networking:</strong> geoclue, samba, nfs</li>
                        <li><strong>Scheduling:</strong> anacron, cron</li>
                    </ul>
                    
                    <h4>Volatile vs Persistent</h4>
                    <div class="table-wrapper">
                        <table>
                            <caption class="sr-only">Storage Persistence Comparison</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Location</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Behavior</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">/</th>
                                    <td>Read-only</td>
                                    <td>Immutable system files</td>
                                </tr>
                                <tr>
                                    <th scope="row">/etc</th>
                                    <td>Overlay</td>
                                    <td>Writable, persists in @data</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var</th>
                                    <td>tmpfs</td>
                                    <td>Volatile, cleared on reboot</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var/log</th>
                                    <td>Btrfs @log</td>
                                    <td>Persistent logs</td>
                                </tr>
                                <tr>
                                    <th scope="row">/var/lib/*</th>
                                    <td>Bind mount</td>
                                    <td>Selective persistence from @data</td>
                                </tr>
                                <tr>
                                    <th scope="row">/home</th>
                                    <td>Btrfs @home</td>
                                    <td>Persistent user data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- SECURITY -->
            <section id="security" class="wiki-section">
                <h2>Security</h2>
                
                <div id="security-overview">
                    <h3>Security Overview</h3>
                    <p>ShaniOS implements defense-in-depth security:</p>
                    
                    <div class="security-features">
                        <div class="security-feature">
                            <h4>ðŸ”’ Immutable Root Filesystem</h4>
                            <p>Read-only root prevents runtime tampering:</p>
                            <ul>
                                <li>Malware cannot modify system files</li>
                                <li>Rootkits cannot persist across reboots</li>
                                <li>System integrity guaranteed</li>
                            </ul>
                        </div>
                        
                        <div class="security-feature">
                            <h4>ðŸ” Full-Disk Encryption</h4>
                            <p>LUKS2 encryption with modern key derivation:</p>
                            <ul>
                                <li>argon2id KDF (resistant to GPU attacks)</li>
                                <li>Password or TPM-based unlocking</li>
                                <li>Protects data at rest</li>
                            </ul>
                        </div>
                        
                        <div class="security-feature">
                            <h4>ðŸ“¦ Application Sandboxing</h4>
                            <p>Flatpak provides application isolation:</p>
                            <ul>
                                <li>Apps run in containers</li>
                                <li>Limited filesystem access</li>
                                <li>Permission-based resource access</li>
                            </ul>
                        </div>
                        
                        <div class="security-feature">
                            <h4>ðŸ›¡ï¸ Mandatory Access Control</h4>
                            <p>AppArmor profiles restrict process capabilities:</p>
                            <ul>
                                <li>System services confined</li>
                                <li>Limits attack surface</li>
                                <li>Prevents privilege escalation</li>
                            </ul>
                        </div>
                        
                        <div class="security-feature">
                            <h4>ðŸŒ Network Security</h4>
                            <p>firewalld pre-configured and active:</p>
                            <ul>
                                <li>Deny inbound by default</li>
                                <li>Zone-based policies</li>
                                <li>Service-specific rules</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div id="secure-boot">
                    <h3>Secure Boot Setup</h3>
                    <p>ShaniOS supports UEFI Secure Boot via Machine Owner Keys (MOK).</p>
                    
                    <h4>Automatic Enrollment (If Enabled During Install)</h4>
                    <p>On first boot with Secure Boot enabled:</p>
                    <ol>
                        <li>MOK Manager appears automatically</li>
                        <li>Select "Enroll MOK"</li>
                        <li>Enter password: <code>shanios</code></li>
                        <li>Reboot to complete enrollment</li>
                    </ol>
                    
                    <h4>Manual Secure Boot Enablement</h4>
                    <p>To enable Secure Boot after installation:</p>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Import MOK Key</h4>
                                <div class="code-block">
                                    <pre><code>sudo mokutil --import /etc/secureboot/keys/MOK.der</code></pre>
                                </div>
                                <p>Set a one-time password when prompted</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Reboot and Enroll</h4>
                                <p>MOK Manager appears on reboot. Select "Enroll MOK" and enter your password</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Enable in BIOS</h4>
                                <p>Enter BIOS/UEFI settings and enable Secure Boot if still disabled</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Verify Enrollment</h4>
                                <div class="code-block">
                                    <pre><code>sudo mokutil --list-enrolled</code></pre>
                                </div>
                            </div>
                        </article>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Note:</strong> If MOK Manager doesn't appear, repeat step 1 and reboot. It only triggers when a key is pending enrollment.</p>
                        </div>
                    </div>
                </div>
                
                <div id="tpm-encryption">
                    <h3>TPM-Based Encryption</h3>
                    <p>Enroll your LUKS encryption key to TPM 2.0 for automatic unlocking.</p>
                    
                    <h4>Prerequisites</h4>
                    <ul>
                        <li>TPM 2.0 hardware module (enabled in BIOS/UEFI)</li>
                        <li>LUKS2 encryption enabled during installation</li>
                        <li><strong>Recommended:</strong> Secure Boot enabled for maximum security</li>
                    </ul>
                    
                    <div class="warning-box" role="alert">
                        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="warning-content">
                            <p><strong>Security Warning:</strong> Without Secure Boot, attackers with physical access can replace your bootloader to steal the encryption key. With Secure Boot, TPM refuses to unlock if the system is tampered with.</p>
                        </div>
                    </div>
                    
                    <h4>Enrollment Process</h4>
                    
                    <div class="steps-container">
                        <article class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Verify TPM</h4>
                                <div class="code-block">
                                    <pre><code>systemd-cryptenroll --tpm2-device=list</code></pre>
                                </div>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Check Secure Boot Status</h4>
                                <div class="code-block">
                                    <pre><code>mokutil --sb-state</code></pre>
                                </div>
                                <p>If disabled, consider enabling Secure Boot first</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Enroll Encryption Key</h4>
                                <p><strong>With Secure Boot (recommended):</strong></p>
                                <div class="code-block">
                                    <pre><code>sudo systemd-cryptenroll --tpm2-device=auto \
              --tpm2-pcrs=0+7 /dev/disk/by-label/shani_root</code></pre>
                                </div>
                                <p><strong>Without Secure Boot:</strong></p>
                                <div class="code-block">
                                    <pre><code>sudo systemd-cryptenroll --tpm2-device=auto \
              --tpm2-pcrs=0 /dev/disk/by-label/shani_root</code></pre>
                                </div>
                                <p>Enter your LUKS password when prompted</p>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Regenerate Boot Images</h4>
                                <p>Both @blue and @green must be updated:</p>
                                <div class="code-block">
                                    <pre><code>sudo gen-efi configure blue
            sudo gen-efi configure green</code></pre>
                                </div>
                            </div>
                        </article>
                        
                        <article class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Test & Verify</h4>
                                <p>Reboot. System should unlock automatically.</p>
                                <div class="code-block">
                                    <pre><code># Verify enrollment
            sudo cryptsetup luksDump /dev/disk/by-label/shani_root | \
              grep systemd-tpm2</code></pre>
                                </div>
                            </div>
                        </article>
                    </div>
                    
                    <h4>Remove TPM Enrollment</h4>
                    <p>To restore password-only unlocking:</p>
                    <div class="code-block">
                        <pre><code>sudo systemd-cryptenroll --wipe-slot=tpm2 \
              /dev/disk/by-label/shani_root
            sudo gen-efi configure blue
            sudo gen-efi configure green</code></pre>
                    </div>
                    
                    <h4>Re-enroll After Enabling Secure Boot</h4>
                    <p>If you enable Secure Boot after TPM enrollment:</p>
                    <div class="code-block">
                        <pre><code># Remove old enrollment
            sudo systemd-cryptenroll --wipe-slot=tpm2 \
              /dev/disk/by-label/shani_root

            # Re-enroll with Secure Boot protection
            sudo systemd-cryptenroll --tpm2-device=auto \
              --tpm2-pcrs=0+7 /dev/disk/by-label/shani_root

            # Update boot images
            sudo gen-efi configure blue
            sudo gen-efi configure green</code></pre>
                    </div>
                    
                    <div class="note-box" role="note">
                        <div class="note-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="note-content">
                            <p><strong>Important:</strong></p>
                            <ul>
                                <li>Your LUKS password remains valid as fallback</li>
                                <li>Firmware changes break TPM unlock (password required)</li>
                                <li>Both boot images must be regenerated</li>
                                <li>Keep LUKS password secure for recovery</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TROUBLESHOOTING -->
            <section id="troubleshooting" class="wiki-section">
                <h2>Troubleshooting</h2>
                
                <h3>Boot Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>System won't boot after update</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS should automatically rollback. If not:</p>
                            <ol>
                                <li>At boot menu, select the previous entry (@blue or @green)</li>
                                <li>System will boot to last known working state</li>
                                <li>Report issue via GitHub or Telegram</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>LUKS password not working after TPM enrollment</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>TPM enrollment adds a new unlock method but preserves your password. If experiencing issues:</p>
                            <ol>
                                <li>Wait a few seconds at the unlock prompt</li>
                                <li>Try entering password again</li>
                                <li>If persistent, boot from live USB and remove TPM enrollment using chroot</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <h3>Update Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>shani-deploy fails with network error</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Check network connectivity:</p>
                            <div class="code-block">
                                <pre><code># Test connectivity
            ping -c 3 shani.dev

            # Check NetworkManager
            systemctl status NetworkManager

            # Retry update
            sudo shani-deploy</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3>Application Issues</h3>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h4>Flatpak app won't start</h4>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Try these steps:</p>
                            <div class="code-block">
                                <pre><code># Update Flatpak
            flatpak update

            # Repair installation
            flatpak repair

            # Check permissions
            flatpak override --show org.app.Name

            # Run from terminal to see errors
            flatpak run org.app.Name</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ -->
            <section id="faq" class="wiki-section">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I install traditional Arch packages with pacman?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>No. The root filesystem is read-only and immutable by design. This is a core security and stability feature, not a limitation. Use Flatpak for GUI applications, and containers (Distrobox, Podman) for development tools and CLI utilities.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>What happens if an update fails?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS includes automatic boot failure detection. If the system fails to boot after an update, it automatically reverts to the previous working image on the next boot attempt. No manual intervention required.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Does ShaniOS support hibernation?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Yes. ShaniOS uses a dedicated @swap subvolume with Copy-on-Write disabled, providing reliable hibernation on Btrfs. This approach solves the traditional Btrfs hibernation challenges.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How do I make persistent changes to system configuration?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>The /etc directory uses overlay filesystem, making it writable despite the read-only root. Simply edit files in /etc normallyâ€”changes are stored in /data/overlay/etc/upper and persist across updates and blue-green switches.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Why does ShaniOS need 32GB minimum storage?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>ShaniOS maintains two complete system images (@blue and @green) for atomic updates. However, Btrfs Copy-on-Write shares unchanged data between them, resulting in only ~18% overhead. The benefit is zero-downtime updates and instant rollback capability.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I use ShaniOS on legacy BIOS systems?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>No. ShaniOS requires UEFI firmware for features like Unified Kernel Images (UKIs), Secure Boot support, and the systemd-boot bootloader. Legacy BIOS is not supported.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I dual-boot ShaniOS with Windows or another Linux?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>Not recommended. Other operating systems may modify the bootloader or ESP partition, potentially breaking ShaniOS boot entries. For running other systems, use virtual machines (QEMU/KVM) or containers instead.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How do I switch between @blue and @green manually?</h3>
                            <div class="toggle-icon"><i class="fas fa-plus"></i></div>
                        </div>
                        <div class="faq-answer">
                            <p>At the systemd-boot menu during startup, select the alternative boot entry. Both @blue and @green entries are always available, allowing instant rollback or testing.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CONTRIBUTE -->
            <section id="contribute" class="wiki-section">
                <h2>Contribute</h2>
                <p>ShaniOS is open-source and welcomes contributions from the community.</p>
                
                <div class="contribute-options">
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fab fa-github"></i></div>
                        <h3>Code Contributions</h3>
                        <p>Contribute to core system development, shani-deploy, installer, or other components.</p>
                        <a href="https://github.com/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">GitHub Organization</a>
                    </div>
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fas fa-bug"></i></div>
                        <h3>Bug Reports</h3>
                        <p>Found a bug? Report it to help improve ShaniOS stability and reliability.</p>
                        <a href="https://t.me/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">Telegram Community</a>
                    </div>
                    <div class="contribute-option">
                        <div class="contribute-icon"><i class="fas fa-book"></i></div>
                        <h3>Documentation</h3>
                        <p>Help improve this wiki and other documentation to make ShaniOS more accessible.</p>
                        <a href="https://github.com/shani8dev" class="btn" target="_blank" rel="noopener noreferrer">Contribute Docs</a>
                    </div>
                </div>
                
                <h3>Development Resources</h3>
                <ul>
                    <li><strong>Website:</strong> <a href="https://shani.dev" target="_blank" rel="noopener noreferrer">shani.dev</a></li>
                    <li><strong>GitHub:</strong> <a href="https://github.com/shani8dev" target="_blank" rel="noopener noreferrer">github.com/shani8dev</a></li>
                    <li><strong>Telegram:</strong> <a href="https://t.me/shani8dev" target="_blank" rel="noopener noreferrer">t.me/shani8dev</a></li>
                </ul>
            </section>
            
            <!-- FOOTER -->
            <footer class="wiki-footer">
                <div class="footer-content">
                    <div class="footer-logo">
                        <img src="assets/images/about.svg" alt="ShaniOS" width="100" height="40" />
                        <p>Immutable. Reliable. Secure.</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; <span id="copyright-year"></span> Shanios Project. Open Source & Immutable.</p>
                    <div class="footer-social">
                        <a href="https://github.com/shani8dev" aria-label="GitHub" target="_blank"><i class="fab fa-github"></i></a>
                        <a href="https://t.me/shani8dev" aria-label="Telegram" target="_blank"><i class="fab fa-telegram"></i></a>
                     </div>
                </div>
            </footer>
        </div>
    </div>
  <!-- Back to Top -->
  <a href="#hero" class="back-to-top" aria-label="Back to top">
    <i class="fas fa-chevron-up"></i>
  </a>

  <!-- Scripts -->
  <script src="assets/js/script.js"></script>
</body>
</html>
